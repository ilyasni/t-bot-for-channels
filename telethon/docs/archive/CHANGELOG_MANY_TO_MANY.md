# Changelog: –ü–µ—Ä–µ—Ö–æ–¥ –∫ Many-to-Many —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

## [2.0.0] - 2024-10-10

### üéØ –û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å–≤—è–∑–∏ "–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º" (User ‚Üí Channels) –∫ —Å–≤—è–∑–∏ "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º" (Users ‚Üî Channels)

### ‚ú® –î–æ–±–∞–≤–ª–µ–Ω–æ

#### –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **`user_channel`** - –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∫–∞–Ω–∞–ª–æ–≤
  - `user_id` (PK) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `channel_id` (PK) - ID –∫–∞–Ω–∞–ª–∞
  - `is_active` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `created_at` - –¥–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏
  - `last_parsed_at` - –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–µ–π

**Channel:**
- `get_or_create(db, channel_username, ...)` - –ø–æ–ª—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–∞–Ω–∞–ª –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π
- `add_user(db, user, is_active)` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∫–∞–Ω–∞–ª—É
- `remove_user(db, user)` - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–∞–Ω–∞–ª–∞
- `get_user_subscription(db, user)` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `update_user_subscription(db, user, ...)` - –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–ø–∏—Å–∫–∏

**User:**
- `get_active_channels(db)` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `get_all_channels(db)` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞–Ω–∞–ª—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–¥–ø–∏—Å–∫–µ

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `migrate_to_many_to_many.py` - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `MIGRATION_MANY_TO_MANY.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- `QUICK_MIGRATION.md` - –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
- `test_many_to_many.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `CHANGELOG_MANY_TO_MANY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–æ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **`channels`** —Ç–∞–±–ª–∏—Ü–∞:
  - ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `user_id` (ForeignKey)
  - ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `is_active` (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ `user_channel`)
  - ‚ùå –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `last_parsed_at` (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ `user_channel`)
  - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `UNIQUE` constraint –Ω–∞ `channel_username`
  - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `UNIQUE` constraint –Ω–∞ `channel_id`

#### –û—Ç–Ω–æ—à–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
- **User.channels** - —Ç–µ–ø–µ—Ä—å many-to-many —á–µ—Ä–µ–∑ `user_channel`
- **Channel.users** - —Ç–µ–ø–µ—Ä—å many-to-many —á–µ—Ä–µ–∑ `user_channel`

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

**bot.py:**
- `add_channel_command()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Channel.get_or_create()` –∏ `channel.add_user()`
- `my_channels_command()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user.get_all_channels()`
- `remove_channel_by_id()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `channel.remove_user()` —Å –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ–º –∫–∞–Ω–∞–ª–∞

**parser_service.py:**
- `parse_user_channels()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user.get_active_channels()`
- `parse_channel_posts()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `user` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π `last_parsed_at`

**cleanup_service.py:**
- `cleanup_user_posts()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user.get_all_channels()`
- `cleanup_channel_posts()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `user` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤

**main.py:**
- `get_user_channels()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user.get_all_channels()` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `subscription_created_at`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ `user_channel`

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∫–∞–Ω–∞–ª–æ–≤ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î –∏–∑-–∑–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `channels` (—É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `user_channel`
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`ON DELETE CASCADE`)

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä)
```
–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
- channels: 150 –∑–∞–ø–∏—Å–µ–π
- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤: 80

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- channels: 80 –∑–∞–ø–∏—Å–µ–π (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)
- user_channel: 150 —Å–≤—è–∑–µ–π
- –°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–æ: 70 –∑–∞–ø–∏—Å–µ–π (47%)
```

### üîß –ú–∏–≥—Ä–∞—Ü–∏—è

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
```bash
python3 migrate_to_many_to_many.py
```

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î (–¥–ª—è SQLite)
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `user_channel`
3. ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
4. ‚úÖ –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –∫–∞–Ω–∞–ª–æ–≤
5. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `posts`
6. ‚úÖ –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—É—é —Ç–∞–±–ª–∏—Ü—É `channels`
7. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É `channels` –±–µ–∑ `user_id`
8. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã

#### –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ú–∞–ª–µ–Ω—å–∫–∞—è –ë–î (<1000 –∑–∞–ø–∏—Å–µ–π): ~1-2 —Å–µ–∫—É–Ω–¥—ã
- –°—Ä–µ–¥–Ω—è—è –ë–î (1000-10000 –∑–∞–ø–∏—Å–µ–π): ~5-10 —Å–µ–∫—É–Ω–¥
- –ë–æ–ª—å—à–∞—è –ë–î (>10000 –∑–∞–ø–∏—Å–µ–π): ~30-60 —Å–µ–∫—É–Ω–¥

### ‚ö†Ô∏è Breaking Changes

#### API –∏–∑–º–µ–Ω–µ–Ω–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ)
**GET `/users/{telegram_id}/channels`**
```json
{
  "channels": [
    {
      "is_active": true,
      "subscription_created_at": "...",  // –ù–û–í–û–ï –ø–æ–ª–µ
      "last_parsed_at": "..."            // –¢–µ–ø–µ—Ä—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
  ]
}
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
```python
# –ë—ã–ª–æ:
channels = db.query(Channel).filter(
    Channel.user_id == user.id
).all()

# –°—Ç–∞–ª–æ:
channels = user.get_active_channels(db)
```

### üìù –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

#### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã Telegram –±–æ—Ç–∞
- ‚úÖ API endpoints (—Å –Ω–æ–≤—ã–º–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ retention
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ—Å—Ç–æ–≤

#### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:
- ‚ö†Ô∏è –ü—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–µ `channels` (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)
- ‚ö†Ô∏è –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `Channel.user_id`

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
python3 test_many_to_many.py
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –ü–æ–¥–ø–∏—Å–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –±–µ–∑ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ú–µ—Ç–æ–¥—ã User –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–∞–º–∏

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `MIGRATION_MANY_TO_MANY.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `QUICK_MIGRATION.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω—ã docstrings –≤–æ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö

### üéâ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —ç–∫–æ–Ω–æ–º–∏—Ç –º–µ—Å—Ç–æ –≤ –ë–î
   - –ú–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π = –±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—Ä–æ—Å—ã

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–∞–Ω–∞–ª–∞–º
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –∫–∞–Ω–∞–ª–∞–º

3. **–ì–∏–±–∫–æ—Å—Ç—å**
   - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **–ß–∏—Å—Ç–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –û–¥–∏–Ω –∫–∞–Ω–∞–ª = –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å
   - –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

–≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è:
- üìä –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–æ–≤
- üë• –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–Ω–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥–ø–∏—Å–æ–∫ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üîî –ì—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫–∞–Ω–∞–ª–∞
- üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–æ–≤
- ü§ù Shared channels –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- üíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ (–æ–¥–∏–Ω –ø–æ—Å—Ç –Ω–∞ –∫–∞–Ω–∞–ª, –∞ –Ω–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å—Å—è

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
cp telegram.db telegram.db.manual_backup

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
pkill -f "python.*main.py"
pkill -f "python.*bot.py"

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python3 migrate_to_many_to_many.py

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
python3 test_many_to_many.py

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
python3 run_system.py &
```

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –í —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
python3 test_many_to_many.py
```

---

**–ê–≤—Ç–æ—Ä—ã:** –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 10 –æ–∫—Ç—è–±—Ä—è 2024

