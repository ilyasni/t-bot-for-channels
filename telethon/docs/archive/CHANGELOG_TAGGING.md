# Changelog: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## –î–∞—Ç–∞: 2025-10-10

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- –ü–æ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é LLM (OpenRouter API)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 3-7 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ–≥–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –¢–µ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –º–∞—Å—Å–∏–≤–∞
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥

#### 2. API Endpoints
- `POST /posts/{post_id}/generate_tags` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
- `POST /users/{telegram_id}/posts/generate_tags` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /posts/tags/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–≥–∞–º
- `GET /users/{telegram_id}/posts` - —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç —Ç–µ–≥–∏ –≤ –æ—Ç–≤–µ—Ç–µ

#### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ä—Å–µ—Ä–æ–º
- –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### models.py
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `tags` (JSON) –≤ –º–æ–¥–µ–ª—å `Post`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ —Ç–µ–≥–æ–≤

#### parser_service.py
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ ID –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤
- –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ú–µ—Ç–æ–¥ `_tag_new_posts_background()` –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### main.py
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞–º–∏
- –û–±–Ω–æ–≤–ª–µ–Ω endpoint –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ (–≤–∫–ª—é—á–∞–µ—Ç —Ç–µ–≥–∏)
- –î–æ–±–∞–≤–ª–µ–Ω endpoint —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ç–µ–≥–∞–º

#### requirements.txt
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `httpx==0.25.2` –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

#### .env.example
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OpenRouter:
  - `OPENROUTER_API_KEY`
  - `OPENROUTER_MODEL`
  - `TAGGING_BATCH_SIZE`

### üÜï –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

#### tagging_service.py
–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏:
- `generate_tags_for_text()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤ —á–µ—Ä–µ–∑ LLM
- `update_post_tags()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –ø–æ—Å—Ç–∞
- `process_posts_batch()` - –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤
- `tag_posts_without_tags()` - —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –±–µ–∑ —Ç–µ–≥–æ–≤

#### add_tags_column.py
–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `tags` –≤ —Ç–∞–±–ª–∏—Ü—É `posts`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQLite –∏ PostgreSQL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### TAGGING_README.md
–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏—Å—Ç–µ–º–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

#### n8n_tagging_workflow_example.json
–ü—Ä–∏–º–µ—Ä n8n workflow:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤ –¥–ª—è –ø–æ—Å—Ç–æ–≤ –±–µ–∑ –Ω–∏—Ö
- –ê–Ω–∞–ª–∏–∑ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–≥–∞–º

### üîß –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
python add_tags_column.py
```

### üìã –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (Docker)

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# –î–æ–±–∞–≤—å—Ç–µ –≤ telethon/.env:
# OPENROUTER_API_KEY=your_key_here
# OPENROUTER_MODEL=openai/gpt-oss-20b:free
# TAGGING_BATCH_SIZE=10

# 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑
cd /home/ilyasni/n8n-server/n8n-installer
docker-compose -f docker-compose.yml -f docker-compose.override.yml build telethon

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
docker-compose -f docker-compose.yml -f docker-compose.override.yml run --rm telethon python add_tags_column.py

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
docker-compose -f docker-compose.yml -f docker-compose.override.yml up -d telethon telethon-bot
```

### üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–¢–µ–≥–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∫–∞–Ω–∞–ª–æ–≤.

#### –†—É—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–≥–æ–≤
```bash
# –î–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞
curl -X POST "http://localhost:8010/posts/123/generate_tags"

# –î–ª—è –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST "http://localhost:8010/users/123456789/posts/generate_tags"
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —Å —Ç–µ–≥–∞–º–∏
```bash
curl "http://localhost:8010/users/123456789/posts"
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–≥–∞–º
```bash
curl "http://localhost:8010/posts/tags/stats"
```

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ –≤ `.env`
- –ù–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –¥–ª—è —Å–≤—è–∑–∏ —Å OpenRouter API

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

- –ú–æ–¥–µ–ª—å: `google/gemini-2.0-flash-exp:free` (–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è, —è–Ω–≤–∞—Ä—å 2025)
- –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞: 10 –ø–æ—Å—Ç–æ–≤
- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏: 1 —Å–µ–∫—É–Ω–¥–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤: 3-7 –Ω–∞ –ø–æ—Å—Ç

**–í–∞–∂–Ω–æ:** –î–ª—è —Ä–∞–±–æ—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ https://openrouter.ai/settings/privacy

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ä—Å–∏–Ω–≥
- –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Rate limiting –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API

### üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á OpenRouter
- –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –¢–µ–≥–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ—Å—Ç–æ–≤ —Å —Ç–µ–∫—Å—Ç–æ–º

### üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [TAGGING_README.md](TAGGING_README.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [OpenRouter Documentation](https://openrouter.ai/docs)
- [n8n Workflow Example](n8n_tagging_workflow_example.json)

### ü§ù –í–∫–ª–∞–¥

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ n8n-server/n8n-installer

