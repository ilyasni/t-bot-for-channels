# üîß –û—Ç—á–µ—Ç –æ–± –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 11 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Assistant

---

## üìã –ó–∞–¥–∞—á–∏

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—à–∏–±–∫–∏
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
5. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å workflow

---

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

### **–ü—Ä–æ–±–ª–µ–º–∞ #1: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –≤ tagging_service.py**

**–°–∏–º–ø—Ç–æ–º—ã:**
```
ERROR:tagging_service:‚ùå TaggingService: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: Expecting value: line 1 column 18 (char 17)
ERROR:tagging_service:–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –æ—Ç–≤–µ—Ç API: ["–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã", "–ø–æ—Ç–µ—Ä–∏", "–∫—Ä—É–ø–Ω—ã–µ –∏–≥—Ä–æ–∫–∏"]
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∂–∞–¥–Ω—ã–π regex `r'\[.*\]'` —Å —Ñ–ª–∞–≥–æ–º `re.DOTALL`
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–ª –æ—Ç –ø–µ—Ä–≤–æ–π `[` –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π `]` –≤ —Å—Ç—Ä–æ–∫–µ
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å–ª–µ –º–∞—Å—Å–∏–≤–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ë–´–õ–û:
json_match = re.search(r'\[.*\]', content, re.DOTALL)

# –°–¢–ê–õ–û:
json_match = re.search(r'\[.*?\]', content, re.DOTALL)  # –ù–µ–∂–∞–¥–Ω—ã–π –∫–≤–∞–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `repr()` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±–µ—Ä—Ç–∫–∞ `try/except` –¥–ª—è JSON decode —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç API (500 —Å–∏–º–≤–æ–ª–æ–≤)

**–§–∞–π–ª:** `telethon/tagging_service.py:276-299`

---

### **–ü—Ä–æ–±–ª–µ–º–∞ #2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–µ–≥–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –¢–µ–≥–∏ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã —Ç–µ–≥–æ–≤
- –ú–æ–≥–ª–∏ –±—ã—Ç—å –ø—É—Å—Ç—ã–µ —Ç–µ–≥–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è:
cleaned_tags = []
seen_tags = set()  # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

for tag in tags:
    tag_cleaned = tag.strip().lower()
    if tag_cleaned and tag_cleaned not in seen_tags:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã: 2-50 —Å–∏–º–≤–æ–ª–æ–≤
        if 2 <= len(tag_cleaned) <= 50:
            cleaned_tags.append(tag_cleaned)
            seen_tags.add(tag_cleaned)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã (2-50 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ Lowercase –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Ç–µ–≥–æ–≤

**–§–∞–π–ª:** `telethon/tagging_service.py:301-326`

---

### **–ü—Ä–æ–±–ª–µ–º–∞ #3: –°–ª–∞–±–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ RAG-—Å–µ—Ä–≤–∏—Å–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAG-—Å–µ—Ä–≤–∏—Å–∞ –ø–æ—Å—Ç—ã –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª retry –º–µ—Ö–∞–Ω–∏–∑–º
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

**1. Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (3 –ø–æ–ø—ã—Ç–∫–∏):**
```python
max_retries = 3
retry_delay = 2.0

for attempt in range(max_retries):
    try:
        response = await client.post(url, json=data)
        if response.status_code == 200:
            return  # –£—Å–ø–µ—Ö
        elif response.status_code >= 500:
            # Server error - retry
            await asyncio.sleep(retry_delay * (attempt + 1))
            continue
    except (httpx.TimeoutException, httpx.ConnectError):
        # Retry –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
        ...
```

**2. Fallback: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ IndexingStatus:**
```python
# –ï—Å–ª–∏ –≤—Å–µ retry –Ω–µ—É–¥–∞—á–Ω—ã
for post_id in post_ids:
    status = IndexingStatus(
        user_id=post.user_id,
        post_id=post_id,
        status="pending",
        error="RAG service unavailable during parsing"
    )
    db.add(status)
db.commit()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü–æ—Å—Ç—ã –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `telethon/parser_service.py:336-426`

---

### **–ü—Ä–æ–±–ª–µ–º–∞ #4: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ retry –¥–ª—è pending –ø–æ—Å—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ failed/pending –ø–æ—Å—Ç–æ–≤
- –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—Ç—Ä—É–¥–Ω–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ: –ù–æ–≤—ã–π API endpoint**

**Endpoint:** `POST /rag/retry/pending`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `user_id` (optional) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `limit` (default: 100) - –ú–∞–∫—Å–∏–º—É–º –ø–æ—Å—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# Retry –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST "http://localhost:8020/rag/retry/pending?user_id=6&limit=50"

# Retry –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
curl -X POST "http://localhost:8020/rag/retry/pending?limit=100"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "queued",
  "user_id": 6,
  "total": 15,
  "message": "–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è 15 –ø–æ—Å—Ç–æ–≤ –∑–∞–ø—É—â–µ–Ω–∞ –≤ —Ñ–æ–Ω–µ"
}
```

**–§–∞–π–ª:** `telethon/rag_service/main.py:229-294`

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **1. RAG Service Health Check**
```bash
curl http://localhost:8020/health
```
```json
{
    "status": "healthy",
    "qdrant_connected": true,
    "gigachat_available": true,
    "openrouter_available": true,
    "version": "0.1.0"
}
```
‚úÖ **–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### **2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ retry endpoint**
```bash
curl -X POST "http://localhost:8020/rag/retry/pending?user_id=6"
```
```json
{
    "status": "success",
    "user_id": 6,
    "total": 0,
    "message": "–ù–µ—Ç –ø–æ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏"
}
```
‚úÖ **–°—Ç–∞—Ç—É—Å:** Endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### **3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏**
```bash
curl http://localhost:8020/rag/stats/6
```
```json
{
    "user_id": 6,
    "collection_name": "telegram_posts_6",
    "vectors_count": 0,
    "points_count": 0,
    "indexed_posts": 18,
    "pending_posts": 0,
    "failed_posts": 0
}
```
‚úÖ **–°—Ç–∞—Ç—É—Å:** 18 –ø–æ—Å—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã

---

### **4. –õ–æ–≥–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
```
ERROR:tagging_service:‚ùå TaggingService: –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
WARNING:tagging_service:‚ö†Ô∏è TaggingService: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–≥–∏
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
```
INFO:tagging_service:‚úÖ TaggingService: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤
INFO:tagging_service:‚úÖ TaggingService: –ü–æ—Å—Ç 460 –æ–±–Ω–æ–≤–ª–µ–Ω —Å —Ç–µ–≥–∞–º–∏: ['—Ü–∏—Ñ—Ä–æ–≤–æ–π id', ...]
INFO:parser_service:‚úÖ ParserService: RAG-—Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω –æ 3 –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–∞—Ö
```

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| `telethon/tagging_service.py` | –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON + –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤ | 261-326 |
| `telethon/parser_service.py` | Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è RAG-—Å–µ—Ä–≤–∏—Å–∞ | 336-426 |
| `telethon/rag_service/main.py` | –ù–æ–≤—ã–π endpoint `/rag/retry/pending` | 229-294 |
| `telethon/docs/features/TAGGING_AND_INDEXING_WORKFLOW.md` | **–ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | - |

---

## üìö –ù–æ–≤–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: **`docs/features/TAGGING_AND_INDEXING_WORKFLOW.md`**

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:**
- üîÑ –ü–æ–ª–Ω—ã–π workflow –æ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- üéØ –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞
- üöÄ –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ retry
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ Production checklist

---

## üöÄ Workflow (Updated)

```
–ü–∞—Ä—Å–µ—Ä (30–º) ‚Üí –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã ‚Üí –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (GigaChat)
                                   ‚Üì
                            –¢–µ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
                                   ‚Üì
                          HTTP ‚Üí RAG-—Å–µ—Ä–≤–∏—Å
                           ‚Üì           ‚Üì
                      Success    Failed/Timeout
                           ‚Üì           ‚Üì
                    –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è   Status: pending
                      –≤ Qdrant       ‚Üì
                           ‚Üì      Retry endpoint
                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚Üì
                            –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –£–ª—É—á—à–µ–Ω–∏—è

### **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- ‚úÖ –ù–µ–∂–∞–¥–Ω—ã–π regex –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏) –¥–ª—è RAG-—Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ Fallback –Ω–∞ IndexingStatus –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### **–ö–∞—á–µ—Å—Ç–≤–æ –î–∞–Ω–Ω—ã—Ö**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤ (–¥–ª–∏–Ω–∞, –¥—É–±–ª–∏–∫–∞—Ç—ã)
- ‚úÖ Lowercase –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
- ‚úÖ Endpoint `/rag/retry/pending` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ pending –ø–æ—Å—Ç–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- ‚úÖ Endpoint `/rag/stats/{user_id}` –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ Health check endpoints

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ò–∑–º–µ–Ω–µ–Ω–∏–π

- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 3
- **–î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫:** ~200
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 1 –Ω–æ–≤—ã–π —Ñ–∞–π–ª (400+ —Å—Ç—Ä–æ–∫)
- **–ù–æ–≤—ã—Ö endpoints:** 1
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤:** 4

---

## üîó API Reference (Updated)

### **Telethon API** (–ø–æ—Ä—Ç 8010)
- `/posts` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —Å —Ç–µ–≥–∞–º–∏
- `/tags/retry_failed` - Retry –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### **RAG Service API** (–ø–æ—Ä—Ç 8020)
- `POST /rag/index/post/{post_id}` - –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ—Å—Ç–∞
- `POST /rag/index/batch` - Batch –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- `POST /rag/index/user/{user_id}` - –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /rag/reindex/user/{user_id}` - –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
- **`POST /rag/retry/pending`** ‚ú® - **Retry pending/failed –ø–æ—Å—Ç–æ–≤**
- `GET /rag/stats/{user_id}` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- `GET /rag/search` - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- `GET /health` - Health check

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
docker logs telethon 2>&1 | grep TaggingService | tail -20
```
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏: `‚úÖ TaggingService: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ N —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–æ–≤`

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
```bash
docker logs rag-service 2>&1 | grep indexer | tail -20
```
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏: `‚úÖ Batch –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —É—Å–ø–µ—à–Ω–æ=N`

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ RAG-—Å–µ—Ä–≤–∏—Å–∞:**
```bash
curl http://localhost:8020/health
```
–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `true` –∏ —Å—Ç–∞—Ç—É—Å `healthy`

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```bash
curl http://localhost:8020/rag/stats/6
```
–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Production

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry pending –ø–æ—Å—Ç–æ–≤**

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:

```bash
# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
0 */6 * * * curl -X POST http://localhost:8020/rag/retry/pending

# –ò–ª–∏ —á–µ—Ä–µ–∑ systemd timer
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞:
- `failed_posts > 10` –≤ `/rag/stats/{user_id}`
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å RAG-—Å–µ—Ä–≤–∏—Å–∞ (`/health` != 200)
- –û—à–∏–±–∫–∏ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

### **–ë—ç–∫–∞–ø—ã**

- PostgreSQL/SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
- Qdrant –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)

---

## üìù Changelog

### **Version 1.0 (11 –æ–∫—Ç—è–±—Ä—è 2025)**

**Added:**
- ‚úÖ –ù–æ–≤—ã–π endpoint `/rag/retry/pending`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–µ–≥–æ–≤
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è RAG-—Å–µ—Ä–≤–∏—Å–∞ (3 –ø–æ–ø—ã—Ç–∫–∏)
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è workflow

**Fixed:**
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ JSON —Å –Ω–µ–∂–∞–¥–Ω—ã–º regex
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ RAG-—Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `repr()` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**Improved:**
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üë§ –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–ü—Ä–æ–µ–∫—Ç:** Telegram Channel Parser  
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** `/home/ilyasni/n8n-server/n8n-installer/telethon`  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/features/TAGGING_AND_INDEXING_WORKFLOW.md`  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞:** 11 –æ–∫—Ç—è–±—Ä—è 2025

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ.

