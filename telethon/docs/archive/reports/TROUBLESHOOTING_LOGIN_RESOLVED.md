# üîß Troubleshooting: –ü—Ä–æ–±–ª–µ–º–∞ "–ö–æ–¥ –∏—Å—Ç–µ–∫" (–†–ï–®–ï–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Å—Ç–∞—Ä–æ–π SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É "The confirmation code has expired"

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û —á–µ—Ä–µ–∑ QR –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (v3.1)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/login` —Å QR –º–µ—Ç–æ–¥–æ–º - —Å–º. [QR_LOGIN_GUIDE.md](docs/quickstart/QR_LOGIN_GUIDE.md)

---

## üìä –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

```
1. /login 3HBP4Z3ECICZ  ‚úÖ OK
2. +79267947366          ‚úÖ OK  
3. SMS –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω     ‚úÖ OK (phone_code_hash —Å–æ—Ö—Ä–∞–Ω–µ–Ω)
4. 85131                 ‚úÖ –í–≤–µ–¥–µ–Ω –∑–∞ 8 —Å–µ–∫—É–Ω–¥
5. sign_in –≤—ã–∑–≤–∞–Ω        ‚úÖ OK (—Å phone_code_hash)
6. ‚ùå PhoneCodeExpiredError
```

### –õ–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç:

```
INFO: SMS –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (phone_code_hash: da07ca7723...)
INFO: –ò—Å–ø–æ–ª—å–∑—É—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π phone_code_hash: da07ca7723...
INFO: –ü–æ–ø—ã—Ç–∫–∞ sign_in –¥–ª—è 139883458 —Å –∫–æ–¥–æ–º 85***
ERROR: PhoneCodeExpiredError
ERROR: –ö–æ–¥ –≤–≤–µ–¥–µ–Ω —á–µ—Ä–µ–∑: 8.0 —Å–µ–∫—É–Ω–¥
```

**–í—ã–≤–æ–¥:** –ö–æ–¥ –ù–ï –ú–û–ì –∏—Å—Ç–µ—á—å –∑–∞ 8 —Å–µ–∫—É–Ω–¥. –≠—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ—Ç Telegram.

---

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ù–æ–º–µ—Ä —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö ‚ö†Ô∏è –ù–ê–ò–ë–û–õ–ï–ï –í–ï–†–û–Ø–¢–ù–û

–ï—Å–ª–∏ –Ω–æ–º–µ—Ä +79267947366 –∞–∫—Ç–∏–≤–µ–Ω –≤:
- Telegram Desktop
- Telegram Mobile  
- –î—Ä—É–≥–æ–º –±–æ—Ç–µ
- –í–µ–±-–≤–µ—Ä—Å–∏–∏

**Telegram –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ API** –¥–ª—è –∑–∞—â–∏—Ç—ã –∞–∫–∫–∞—É–Ω—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ –í–°–ï–• Telegram –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ `/login`

**–ò–ª–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–≥–¥–µ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.

### 2. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω–æ–º–µ—Ä –ø—ã—Ç–∞–ª—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –º–Ω–æ–≥–æ —Ä–∞–∑ –∑–∞ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–∏–æ–¥, Telegram –≤—Ä–µ–º–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30-60 –º–∏–Ω—É—Ç
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### 3. –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è API_ID

–î–∞–∂–µ –Ω–æ–≤—ã–π MASTER_API_ID (9602513) –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω, –µ—Å–ª–∏:
- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö" IP –∞–¥—Ä–µ—Å–æ–≤
- Telegram –≤–∏–¥–∏—Ç –ø–∞—Ç—Ç–µ—Ä–Ω bot-like –ø–æ–≤–µ–¥–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–π—Ç–µ –µ—â–µ –æ–¥–∏–Ω MASTER_API_ID (—Ç—Ä–µ—Ç–∏–π)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN/–ø—Ä–æ–∫—Å–∏
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ `/auth` (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å–æ —Å–≤–æ–∏–º–∏ credentials)

---

## ‚úÖ –ß—Ç–æ –¢–û–ß–ù–û —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞:

- ‚úÖ PostgreSQL timezone (–≤—Å–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è aware)
- ‚úÖ phone_code_hash —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–∂–¥—É send_code –∏ sign_in
- ‚úÖ Session —Ñ–∞–π–ª—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ permissions
- ‚úÖ ConversationHandler —Å allow_reentry
- ‚úÖ Async locks –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:

```python
# ‚úÖ –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
sent_code = await client.send_code_request(phone)
# phone_code_hash: da07ca7723...

# ‚úÖ –¢–æ—Ç –∂–µ –∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
client = self.active_clients[telegram_id]

# ‚úÖ phone_code_hash –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è
await client.sign_in(phone, code, phone_code_hash=phone_code_hash)

# ‚ùå Telegram –æ—Ç–≤–µ—á–∞–µ—Ç: PhoneCodeExpiredError
```

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –î—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ)

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–æ—Ç–æ—Ä—ã–π:
- –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º Telegram –∫–ª–∏–µ–Ω—Ç–µ
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Ä–∞–Ω–µ–µ
- –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–æ–≤—ã–π SIM-–∫–∞—Ä—Ç–∞

**–ü—Ä–∏–º–µ—Ä:**
```
/login 3HBP4Z3ECICZ
‚Üí +79991112233  (–¥—Ä—É–≥–æ–π –Ω–æ–º–µ—Ä)
‚Üí –∫–æ–¥ –∏–∑ SMS
‚Üí ‚úÖ –î–æ–ª–∂–Ω–æ —Å—Ä–∞–±–æ—Ç–∞—Ç—å!
```

### –†–µ—à–µ–Ω–∏–µ 2: –¢–µ—Ä–º–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π

–ü–µ—Ä–µ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –±–æ—Ç–∞:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram Desktop/Mobile
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí Devices
3. Terminate all other sessions
4. –í—ã–π–¥–∏—Ç–µ –∏–∑ Telegram
5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 –º–∏–Ω—É—Ç
6. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ `/login` –≤ –±–æ—Ç–µ

### –†–µ—à–µ–Ω–∏–µ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è `/auth`

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ —Å–æ —Å–≤–æ–∏–º–∏ API –∫–ª—é—á–∞–º–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ https://my.telegram.org
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/auth` –≤ –±–æ—Ç–µ
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤–µ–±-—Ñ–æ—Ä–º—ã

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –°–≤–æ–∏ API –∫–ª—é—á–∏, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è Telegram

---

## üß™ –¢–µ—Å—Ç —Å –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ **–¥—Ä—É–≥–∏–º Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º** (–Ω–µ Ilya Kozlov):

```
/login 3HBP4Z3ECICZ
‚Üí +–¥—Ä—É–≥–æ–π_–Ω–æ–º–µ—Ä
‚Üí –∫–æ–¥
```

–ï—Å–ª–∏ —Å –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º —Å—Ä–∞–±–æ—Ç–∞–µ—Ç - –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞ –¥–ª—è –Ω–æ–º–µ—Ä–∞ +79267947366.

---

## üìû –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: QR Login (future)

–í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å QR-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:

```python
# Telethon –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç QR login
await client.qr_login()
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR –∫–æ–¥ –≤ —Å–≤–æ–µ–º Telegram
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑ SMS
```

–≠—Ç–æ –æ–±—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—É —Å "code expired".

---

## üìã Summary

**–ü—Ä–æ–±–ª–µ–º–∞:** PhoneCodeExpiredError –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–¥–∞ –∑–∞ 8 —Å–µ–∫—É–Ω–¥

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–ï –≤ –Ω–∞—à–µ–º –∫–æ–¥–µ. Telegram –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ:
- –ù–æ–º–µ—Ä —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏—è:**
1. ‚úÖ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å **–¥—Ä—É–≥–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞**
2. ‚úÖ –¢–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏ –≤ Telegram Settings
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/auth` (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º)
4. ‚úÖ –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-2 —á–∞—Å–∞ –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞

**–ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏.

