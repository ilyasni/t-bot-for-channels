[pytest]
# Async режим - автоматическое обнаружение async тестов
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Пути для поиска тестов
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Маркеры для категоризации тестов
markers =
    unit: Unit tests (изолированные, с моками)
    integration: Integration tests (с реальными сервисами)
    slow: Slow tests (>1 секунды)
    external_api: Tests requiring external APIs
    auth: Authentication tests
    rag: RAG system tests
    groups: Groups functionality tests
    voice: Voice transcription tests
    event_loop: Event loop fix tests (Context7 best practices)

# Опции запуска по умолчанию
addopts = 
    --strict-markers
    --tb=short
    -v
    --cov=.
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=60
    --ignore=scripts/
    --ignore=examples/
    --ignore=docs/
    --ignore=logs/
    --ignore=sessions/
    --ignore=data/

# Настройки вывода
console_output_style = progress
log_cli = false
log_cli_level = INFO

# Timeout для тестов (предотвращает зависания)
timeout = 30
timeout_method = thread

