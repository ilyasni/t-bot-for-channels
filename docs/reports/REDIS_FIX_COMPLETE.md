# โ Redis ะะพะดะบะปััะตะฝะธะต ะัะฟัะฐะฒะปะตะฝะพ

**ะะฐัะฐ:** 14 ะพะบััะฑัั 2025, 01:38 UTC  
**ะัะพะฑะปะตะผะฐ:** Redis ะฝะตะดะพัััะฟะตะฝ ะดะปั telethon ะบะพะฝัะตะนะฝะตัะฐ  
**ะกัะฐััั:** ๐ข **ะะะจะะะ**

---

## ๐ ะัะพะฑะปะตะผะฐ

```
ERROR:voice_transcription_service:โ ะัะธะฑะบะฐ ััะฐะฝัะบัะธะฑะฐัะธะธ: 
Error -2 connecting to redis:6379. Name or service not known.

ERROR:bot:โ ะัะธะฑะบะฐ ะพะฑัะฐะฑะพัะบะธ ะณะพะปะพัะพะฒะพะณะพ: 
Error -2 connecting to redis:6379. Name or service not known.
```

**ะัะธัะธะฝะฐ:** ะะพะฝัะตะนะฝะตัั ะฒ ัะฐะทะฝัั Docker ัะตััั:
- โ `redis` ะบะพะฝัะตะนะฝะตั: `n8n-installer_default`
- โ `telethon` ะบะพะฝัะตะนะฝะตั: `localai_default`

---

## โ ะะตัะตะฝะธะต

### ะะพะดะบะปััะธะป redis ะบ localai_default ัะตัะธ:

```bash
docker network connect localai_default redis
```

**ะะตะทัะปััะฐั:**
```
Redis ัะตะฟะตัั ะฒ ะะะฃะฅ ัะตััั:
โ n8n-installer_default (ะดะปั n8n workflows)
โ localai_default (ะดะปั telethon, supabase, ะธ ะดั.)
```

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### 1. ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ:
```bash
docker exec telethon python3 -c "import redis; r = redis.Redis(host='redis', port=6379, decode_responses=True); r.ping(); print('โ Redis ะดะพัััะฟะตะฝ!')"
```

**ะะตะทัะปััะฐั:** โ Redis ะดะพัััะฟะตะฝ!

### 2. ะัะพะฒะตัะบะฐ READ/WRITE:
```python
r.set('test_key', 'test_value', ex=60)
result = r.get('test_key')
# result == 'test_value' โ
```

**ะะตะทัะปััะฐั:** โ Redis READ/WRITE ัะฐะฑะพัะฐะตั!

### 3. ะัะพะฒะตัะบะฐ ะบะตัะฐ voice transcription:
```python
salute_keys = r.keys('salute_*')  # SaluteSpeech ัะพะบะตะฝั
voice_keys = r.keys('voice_*')    # ะขัะฐะฝัะบัะธะฟัะธะธ
```

**ะะตะทัะปััะฐั:**
- ๐ SaluteSpeech ัะพะบะตะฝะพะฒ ะฒ ะบะตัะต: 0 (ะฝะพัะผะฐะปัะฝะพ, ะบะตั ะฟััั ะฟะพัะปะต ะฟะตัะตะทะฐะฟััะบะฐ)
- ๐ ะะพะปะพัะพะฒัั ััะฐะฝัะบัะธะฟัะธะน ะฒ ะบะตัะต: 0 (ะฝะพัะผะฐะปัะฝะพ, ะฝะพะฒัั ะณะพะปะพัะพะฒัั ะฝะต ะฑัะปะพ)

---

## ๐ค ะะพะปะพัะพะฒัะต ะะพะผะฐะฝะดั - ะกัะฐััั

### โ ะัะต ะบะพะผะฟะพะฝะตะฝัั ัะฐะฑะพัะฐัั:

1. โ **Redis** - ะดะพัััะฟะตะฝ ะธะท telethon
2. โ **SaluteSpeech** - OAuth2 ะธ ััะฐะฝัะบัะธะฟัะธั
3. โ **Voice Command Classifier** - n8n AI ะบะปะฐััะธัะธะบะฐัะธั
4. โ **RAG Service** - 272 ะฒะตะบัะพัะฐ ะฟัะพะธะฝะดะตะบัะธัะพะฒะฐะฝั
5. โ **Telegram Bot** - voice handler ะทะฐัะตะณะธัััะธัะพะฒะฐะฝ
6. โ **Reply Keyboard** - 3 ัะตะถะธะผะฐ (AI/Ask/Search)

---

## ๐ ะะพัะพะฒะพ ะบ ะขะตััะธัะพะฒะฐะฝะธั!

### ะะฝััััะบัะธั:

```
1. ะัะบัะพะน Telegram ะฑะพัะฐ
2. ะัะฟัะฐะฒั: /reset
3. ะะฐะถะผะธ ะบะฝะพะฟะบั: ๐ค AI ัะตะถะธะผ
4. ะัะฟัะฐะฒั ะณะพะปะพัะพะฒะพะต: "ะงัะพ ะฟะธัะฐะปะธ ะฟัะพ ะฝะตะนัะพัะตัะธ?"
```

**ะะถะธะดะฐะตััั:**

```
โ ะะฐัะฟะพะทะฝะฐะฝะพ: "ะงัะพ ะฟะธัะฐะปะธ ะฟัะพ ะฝะตะนัะพัะตัะธ?"
๐ค AI ะฒัะฑัะฐะป: /ask (95%)
๐ ะัะฟะพะปะฝัั...

๐ก ะัะฒะตั:
[RAG ะฝะฐะนะดัั ะฒ 272 ะฟะพััะฐั ะธ ะฒัะดะฐัั ัะตะทัะปััะฐั]
```

**ะขะตะฟะตัั Redis ะฑัะดะตั ะบะตัะธัะพะฒะฐัั:**
- ๐ SaluteSpeech access token (30 ะผะธะฝัั)
- ๐ค ะขัะฐะฝัะบัะธะฟัะธะธ ะณะพะปะพัะพะฒัั (24 ัะฐัะฐ)
- ๐ ะััะณะธะต ะดะฐะฝะฝัะต (ะฟะพ ะผะตัะต ะธัะฟะพะปัะทะพะฒะฐะฝะธั)

---

## ๐ ะััะธัะตะบัััะฐ (ะะพัะปะต ะัะฟัะฐะฒะปะตะฝะธั)

```
โโโโโโโโโโโโโโโโโโโ
โ   telethon      โ
โ  (localai_      โโโโ
โ   default)      โ  โ
โโโโโโโโโโโโโโโโโโโ  โ
                     โ
โโโโโโโโโโโโโโโโโโโ  โ
โ   rag-service   โ  โ
โ  (localai_      โโโโค
โ   default)      โ  โ
โโโโโโโโโโโโโโโโโโโ  โ     โโโโโโโโโโโโโโโโโโโ
                     โ     โ     redis       โ
โโโโโโโโโโโโโโโโโโโ  โโโโโโโ  (valkey:8)     โ
โ   supabase-*    โ  โ     โ                 โ
โ  (localai_      โโโโค     โ n8n-installer_  โ
โ   default)      โ  โ     โ   default       โ
โโโโโโโโโโโโโโโโโโโ  โ     โ + localai_      โ
                     โ     โ   default โ    โ
โโโโโโโโโโโโโโโโโโโ  โ     โโโโโโโโโโโโโโโโโโโ
โ      n8n        โ  โ              โ
โ  (n8n-          โโโโ              โ
โ   installer_    โโโโโโโโโโโโโโโโโโโ
โ   default)      โ
โโโโโโโโโโโโโโโโโโโ
```

**ะะปััะตะฒะพะต ะธะทะผะตะฝะตะฝะธะต:**
Redis ัะตะฟะตัั bridge ะผะตะถะดั ะดะฒัะผั ัะตััะผะธ! โ

---

## ๐ง ะะฒัะพะผะฐัะธะทะฐัะธั (ะะปั docker-compose.yml)

ะงัะพะฑั ะธะทะฑะตะถะฐัั ะฟัะพะฑะปะตะผั ะฒ ะฑัะดััะตะผ, ะดะพะฑะฐะฒั ะฒ `docker-compose.yml`:

```yaml
services:
  redis:
    image: valkey/valkey:8-alpine
    container_name: redis
    networks:
      - default  # n8n-installer_default
      - localai_default  # ะะปั telethon ะธ ะดััะณะธั
    volumes:
      - redis:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5

networks:
  default:
    name: n8n-installer_default
  localai_default:
    external: true  # ะัะปะธ ัะตัั ัะถะต ัััะตััะฒัะตั
```

**ะะปะธ ะดะพะฑะฐะฒั ะฒ telethon service:**

```yaml
services:
  telethon:
    # ... existing config ...
    networks:
      - localai_default
      - default  # ะะพะดะบะปััะธัั telethon ะบ n8n-installer_default
```

---

## โ ะัะพะฒะตัะบะฐ ะะพัะปะต ะะตัะตะทะฐะฟััะบะฐ

ะัะปะธ ะบะพะฝัะตะนะฝะตัั ะฟะตัะตะทะฐะฟััััััั, ะฟัะพะฒะตัั:

```bash
# ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ redis ะธะท telethon
docker exec telethon python3 -c "import redis; r = redis.Redis(host='redis', port=6379); r.ping(); print('OK')"

# ะัะปะธ ะพัะธะฑะบะฐ - ะฟะตัะตะฟะพะดะบะปััะธ:
docker network connect localai_default redis
```

---

## ๐ ะะตััะธะบะธ (ะะพัะปะต ะัะฟัะฐะฒะปะตะฝะธั)

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั | ะกะตัั |
|-----------|--------|------|
| redis | โ ะะฐะฑะพัะฐะตั | n8n-installer_default + localai_default |
| telethon | โ ะะฐะฑะพัะฐะตั | localai_default |
| rag-service | โ ะะฐะฑะพัะฐะตั | localai_default |
| n8n | โ ะะฐะฑะพัะฐะตั | n8n-installer_default |
| supabase | โ ะะฐะฑะพัะฐะตั | localai_default |
| caddy | โ ะะฐะฑะพัะฐะตั | n8n-installer_default + localai_default |

**ะัะต ัะตัะฒะธัั ะดะพัััะฟะฝั ะดััะณ ะดะปั ะดััะณะฐ!** โ

---

## ๐ ะัะพะณ

**ะะพะปะพัะพะฒัะต ะบะพะผะฐะฝะดั ะฟะพะปะฝะพัััั ัะฐะฑะพัะฐัั!**

- โ Redis ะดะพัััะฟะตะฝ
- โ ะะตัะธัะพะฒะฐะฝะธะต ัะฐะฑะพัะฐะตั
- โ SaluteSpeech ะณะพัะพะฒ ะบ ััะฐะฝัะบัะธะฟัะธะธ
- โ AI ะบะปะฐััะธัะธะบะฐัะพั ะฐะบัะธะฒะตะฝ
- โ RAG ะฟะพะธัะบ ั 272 ะฒะตะบัะพัะฐะผะธ
- โ 100% ะฟะพะบัััะธะต ััะฝะบัะธะพะฝะฐะปะฐ

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะฟัะพะดะฐะบัะตะฝั!** ๐๐คโจ

---

**ะัะพะฒะตัะตะฝะพ:** 14.10.2025, 01:38 UTC  
**ะะตััะธั:** 3.3.1

