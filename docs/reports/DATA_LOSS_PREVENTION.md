# üõ°Ô∏è –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö n8n

## ‚ùå –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ 14 –æ–∫—Ç—è–±—Ä—è 2025

**PostgreSQL volume –±—ã–ª —É–¥–∞–ª–µ–Ω/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –≤–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –≤—Å–µ workflows –∏ credentials –ø–æ—Ç–µ—Ä—è–Ω—ã.**

### –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è:

```
06.10.2025 22:55 - –°–æ–∑–¥–∞–Ω—ã –ø–µ—Ä–≤—ã–µ volumes (n8n-installer_*)
13.10.2025 22:35 - –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ workflows
14.10.2025 07:50 - PostgreSQL volume –ü–ï–†–ï–°–û–ó–î–ê–ù (localai_langfuse_postgres_data)
14.10.2025 10:50 - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
```

### –ü—Ä–∏—á–∏–Ω–∞:

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Å–º–µ–Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —á—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫:
1. –°–æ–∑–¥–∞–Ω–∏—é –Ω–æ–≤—ã—Ö volumes —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `localai_*` –≤–º–µ—Å—Ç–æ `n8n-installer_*`
2. PostgreSQL –∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Å –ø—É—Å—Ç–æ–π –ë–î
3. –°—Ç–∞—Ä—ã–µ volumes –≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥–æ–π `docker-compose down -v` –∏–ª–∏ `docker volume prune`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –≤—Ä—É—á–Ω—É—é

```bash
cd /home/ilyasni/n8n-server/n8n-installer

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
./scripts/backup-n8n-postgres.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# .backups/postgres/n8n-postgres-backup-YYYYMMDD-HHMMSS.sql.gz
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤ (cron)

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–±—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00):
0 3 * * * /home/ilyasni/n8n-server/n8n-installer/scripts/backup-n8n-postgres.sh >> /home/ilyasni/n8n-server/n8n-installer/.backups/postgres/backup.log 2>&1
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±—ç–∫–∞–ø—ã
ls -lh .backups/postgres/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
./scripts/restore-n8n-postgres.sh n8n-postgres-backup-20251014-030000.sql.gz
```

---

## üîí –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º

### 1. –ü–µ—Ä–µ–¥ –õ–Æ–ë–´–ú –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø PostgreSQL
./scripts/backup-n8n-postgres.sh

# 2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflows –≤—Ä—É—á–Ω—É—é
# –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI ‚Üí Settings ‚Üí Import/Export ‚Üí Export all workflows

# 3. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –∫–æ–Ω—Ñ–∏–≥–æ–≤ (—É–∂–µ –µ—Å—Ç—å –≤ .backups/)
cp docker-compose.yml .backups/docker-compose.yml.$(date +%Y%m%d-%H%M%S)
```

### 2. –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `-v` —Ñ–ª–∞–≥

```bash
# ‚ùå –û–ü–ê–°–ù–û - —É–¥–∞–ª–∏—Ç –≤—Å–µ volumes!
docker-compose down -v

# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, volume –æ—Å—Ç–∞–Ω—É—Ç—Å—è
docker-compose down
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ volumes –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ volumes
docker volume ls

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ volume
docker run --rm -v VOLUME_NAME:/data:ro alpine ls -lah /data/

# –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ (dangling) volumes
docker volume prune

# –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ --all –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏!
# docker volume prune --all  # ‚ùå –û–ü–ê–°–ù–û!
```

---

## üìã –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ï–∂–µ–¥–Ω–µ–≤–Ω–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cron):

```bash
0 3 * * * /home/ilyasni/n8n-server/n8n-installer/scripts/backup-n8n-postgres.sh
```

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–≤—Ä—É—á–Ω—É—é):

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workflows
docker exec postgres psql -U postgres -d postgres -c "SELECT COUNT(*) FROM workflow_entity;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ë–î
docker exec postgres psql -U postgres -d postgres -c "SELECT pg_size_pretty(pg_database_size('postgres'));"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –±—ç–∫–∞–ø–æ–≤
ls -lh .backups/postgres/ | tail -10
```

---

## üÜò –ê–≤–∞—Ä–∏–π–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ä—ã–µ volumes:**
   ```bash
   docker volume ls -f dangling=true
   docker run --rm -v OLD_VOLUME:/data:ro alpine ls -lah /data/
   ```

2. **–ü–æ–∏—Å–∫–∞—Ç—å SQL –¥–∞–º–ø—ã:**
   ```bash
   find /home/ilyasni/ -name "*.sql*" -mtime -30
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç—ã –∏–∑ n8n UI:**
   ```bash
   find ~ -name "*.json" -path "*/Downloads/*" -mtime -30
   ```

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞:**
   ```bash
   ./scripts/restore-n8n-postgres.sh LATEST_BACKUP.sql.gz
   ```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –î–ï–õ–ê–¢–¨:

- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflows –≤—Ä—É—á–Ω—É—é –∏–∑ UI
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å named volumes –≤ docker-compose.yml
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –±—ç–∫–∞–ø–æ–≤
- ‚úÖ –•—Ä–∞–Ω–∏—Ç—å –±—ç–∫–∞–ø—ã –≤–Ω–µ Docker volumes

### ‚ùå –ù–ï –î–ï–õ–ê–¢–¨:

- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `docker-compose down -v`
- ‚ùå –ó–∞–ø—É—Å–∫–∞—Ç—å `docker volume prune --all`
- ‚ùå –£–¥–∞–ª—è—Ç—å volumes –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- ‚ùå –û–±–Ω–æ–≤–ª—è—Ç—å —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –±—ç–∫–∞–ø–æ–≤
- ‚ùå –ü–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ Docker volumes

---

## üìû –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
2. **–ù–ï –£–î–ê–õ–Ø–¢–¨ volumes**
3. **–°–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö volumes:** `docker volume ls > volumes.txt`
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:** `./scripts/inspect-volume.sh VOLUME_NAME`
5. **–û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é —Å –ª–æ–≥–∞–º–∏**

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 14.10.2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 14.10.2025

