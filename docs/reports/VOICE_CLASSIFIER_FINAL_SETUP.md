# üéØ Voice Command Classifier - –§–ò–ù–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê

**–î–∞—Ç–∞:** 13 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤, –æ—Å—Ç–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û:

1. ‚úÖ **bot.py –æ–±–Ω–æ–≤–ª–µ–Ω:**
   - –ú–µ—Ç–æ–¥ `_classify_voice_command()` –¥–ª—è –≤—ã–∑–æ–≤–∞ n8n
   - Fallback –Ω–∞ –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ AI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `/rag/search` –º–µ—Ç–æ–¥: POST ‚Üí GET

2. ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã:**
   ```bash
   # –í telethon/.env:
   N8N_WEBHOOK_URL=http://n8n:5678
   VOICE_AI_CLASSIFIER_ENABLED=true
   ```

3. ‚úÖ **n8n workflow —Å–æ–∑–¥–∞–Ω:**
   - `n8n/workflows/voice_command_classifier.json`
   - –ë–ï–ó —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è credentials (authentication: none)
   - –° fallback –Ω–∞ —ç–≤—Ä–∏—Å—Ç–∏–∫—É –µ—Å–ª–∏ GigaChat –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

4. ‚úÖ **–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

---

## üö® –û–°–¢–ê–õ–û–°–¨: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow –≤ n8n

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ n8n

```
http://localhost:5678
```

### –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ workflow

1. **–ù–∞–∂–º–∏—Ç–µ "+" –≤ –ª–µ–≤–æ–º –º–µ–Ω—é**
2. **–í—ã–±–µ—Ä–∏—Ç–µ "Import from File"**
3. **–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª:**
   ```
   n8n/workflows/voice_command_classifier.json
   ```
4. **–ù–∞–∂–º–∏—Ç–µ "Import"**

**–í–∞–∂–Ω–æ:** Workflow –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó –æ—à–∏–±–æ–∫ –∏ –ë–ï–ó —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è credentials!

### –®–∞–≥ 3: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π workflow **"Voice Command Classifier"**
2. **–ù–∞–∂–º–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å "Active" ‚úÖ** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
3. –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –∑–µ–ª–µ–Ω—ã–º

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook —á–µ—Ä–µ–∑ curl

```bash
curl -X POST http://localhost:5678/webhook/voice-classify \
  -H "Content-Type: application/json" \
  -d '{
    "transcription": "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ",
    "user_id": 1
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "command": "search",
  "confidence": 0.9,
  "reasoning": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫",
  "original_transcription": "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ",
  "user_id": 1
}
```

**–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç:**
- ‚ùå Workflow –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- ‚ùå Workflow –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- ‚ùå n8n –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –¢–µ—Å—Ç 2: –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

**–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ –ë–ï–ó –∫–æ–º–∞–Ω–¥—ã:**

```
[–ì–æ–ª–æ—Å–æ–≤–æ–µ: "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ"]
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**

#### ‚úÖ –° –∞–∫—Ç–∏–≤–Ω—ã–º workflow:
```
‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ"

ü§ñ AI –≤—ã–±—Ä–∞–ª: /search (90% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏)
üîç –í—ã–ø–æ–ª–Ω—è—é...

üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ"
üì± –í–∞—à–∏ –ø–æ—Å—Ç—ã (3):...
```

#### ‚ö†Ô∏è –ë–ï–ó –∞–∫—Ç–∏–≤–Ω–æ–≥–æ workflow (fallback):
```
‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ"

ü§î –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
[üí° /ask - RAG –ø–æ–∏—Å–∫]
[üîç /search - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫]
```

---

## üìä –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –õ–æ–≥–∏ –±–æ—Ç–∞ (–µ—Å–ª–∏ AI —Ä–∞–±–æ—Ç–∞–µ—Ç):

```bash
docker logs telethon 2>&1 | grep -E "(AI –∫–ª–∞—Å—Å–∏—Ñ|classify)" | tail -10

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
INFO: ü§ñ AI classification: search (confidence: 90%)
```

### –õ–æ–≥–∏ –±–æ—Ç–∞ (–µ—Å–ª–∏ AI –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç):

```bash
docker logs telethon 2>&1 | grep -E "(AI –∫–ª–∞—Å—Å–∏—Ñ|–Ω–µ–¥–æ—Å—Ç—É–ø)" | tail -10

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
WARNING: ‚ö†Ô∏è AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
```

### n8n Executions:

```
http://localhost:5678 ‚Üí Executions ‚Üí Voice Command Classifier

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ —Å:
- Timestamp
- Success ‚úÖ
- Input data
```

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

| –ì–æ–ª–æ—Å–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å | AI –∫–æ–º–∞–Ω–¥–∞ | Confidence |
|-----------------|-----------|------------|
| "–ù–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∞–≤—Ç–æ" | `/search` | 90% |
| "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?" | `/ask` | 95% |
| "–ì–¥–µ –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—å–∏ –ø—Ä–æ AI?" | `/search` | 88% |
| "–†–∞—Å—Å–∫–∞–∂–∏ –æ –±–ª–æ–∫—á–µ–π–Ω–µ" | `/ask` | 92% |
| "–ü–æ–∫–∞–∂–∏ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ Tesla" | `/search` | 87% |

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

```
Webhook (POST /webhook/voice-classify)
  ‚Üì
Extract Input (transcription, user_id)
  ‚Üì
Prepare Prompt (–ø—Ä–æ–º–ø—Ç –¥–ª—è GigaChat)
  ‚Üì
GigaChat Classify (HTTP POST –∫ gpt2giga-proxy) [–ë–ï–ó AUTH]
  ‚Üì
Parse & Validate (–ø–∞—Ä—Å–∏–Ω–≥ JSON + fallback —ç–≤—Ä–∏—Å—Ç–∏–∫–∞)
  ‚Üì
Respond to Webhook (JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
```

**–£–∑–ª–æ–≤:** 6  
**Credentials:** –ù–ï —Ç—Ä–µ–±—É—é—Ç—Å—è ‚úÖ  
**Fallback:** –í—Å—Ç—Ä–æ–µ–Ω –≤ "Parse & Validate" ‚úÖ

---

## üêõ Troubleshooting

### ‚ùå "Credentials for 'Header Auth' are not set"

**–ù–ï –î–û–õ–ñ–ù–û –ø–æ—è–≤–ª—è—Ç—å—Å—è!** –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–æ—Å—å:
- –í—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é workflow
- –£–¥–∞–ª–∏—Ç–µ –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

### ‚ùå Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Workflow –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
2. Path –≤ Webhook —É–∑–ª–µ –Ω–µ `voice-classify`

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–∑–µ–ª "Webhook" ‚Üí Path = `voice-classify`
3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow (–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å Active ‚úÖ)

### ‚ùå –í n8n –Ω–µ—Ç Executions –¥–ª—è Voice Command Classifier

**–ü—Ä–∏—á–∏–Ω–∞:** Workflow –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
# 1. Workflow –∞–∫—Ç–∏–≤–µ–Ω?
http://localhost:5678 ‚Üí Workflows ‚Üí Voice Command Classifier
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚úÖ Active

# 2. Webhook –¥–æ—Å—Ç—É–ø–µ–Ω?
curl -X POST http://localhost:5678/webhook/voice-classify \
  -H "Content-Type: application/json" \
  -d '{"transcription":"—Ç–µ—Å—Ç","user_id":1}'
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON

# 3. –ë–æ—Ç –≤—ã–∑—ã–≤–∞–µ—Ç n8n?
docker logs telethon 2>&1 | grep "classify"
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ –≤—ã–∑–æ–≤–æ–≤
```

### ‚ùå GigaChat timeout –≤ workflow

**–ü—Ä–∏—á–∏–Ω–∞:** gpt2giga-proxy –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
docker logs gpt2giga-proxy --tail 50
docker restart gpt2giga-proxy
```

Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –Ω–∞ —ç–≤—Ä–∏—Å—Ç–∏–∫—É!

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **Workflow:** `n8n/workflows/voice_command_classifier.json`
- **–ö–æ–¥ –±–æ—Ç–∞:** `telethon/bot.py` (–º–µ—Ç–æ–¥ `_classify_voice_command`)
- **Env:** `telethon/.env` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `N8N_WEBHOOK_URL`)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
  - [WORKFLOW_FIXED.md](WORKFLOW_FIXED.md) - –¥–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
  - [VOICE_AI_CLASSIFIER_READY.md](VOICE_AI_CLASSIFIER_READY.md) - –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

---

## ‚úÖ CHECKLIST –§–ò–ù–ê–õ–¨–ù–û–ô –ü–†–û–í–ï–†–ö–ò

–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ workflow –≤ n8n:

- [ ] Workflow "Voice Command Classifier" –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] Workflow –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (‚úÖ Active –≤ n8n)
- [ ] –ù–ï–¢ –æ—à–∏–±–∫–∏ "Credentials required"
- [ ] Webhook –¥–æ—Å—Ç—É–ø–µ–Ω (`curl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON)
- [ ] –í n8n ‚Üí Executions –ø–æ—è–≤–ª—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏
- [ ] –õ–æ–≥–∏ –±–æ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `ü§ñ AI classification: ...`
- [ ] –ì–æ–ª–æ—Å–æ–≤–æ–µ –ë–ï–ó –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `/ask` –∏–ª–∏ `/search`

---

## üéâ –ì–û–¢–û–í–û!

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `voice_command_classifier.json` –≤ n8n
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ –ë–ï–ó –∫–æ–º–∞–Ω–¥—ã –≤ Telegram
4. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å AI-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π! üöÄ

---

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting –≤—ã—à–µ! ‚òùÔ∏è

