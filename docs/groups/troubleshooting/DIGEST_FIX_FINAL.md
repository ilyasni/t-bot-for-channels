# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ –¥–∞–π–¥–∂–µ—Å—Ç–∞ - –†–ï–®–ï–ù–ò–ï –ù–ê–ô–î–ï–ù–û

**–î–∞—Ç–∞:** 13 –æ–∫—Ç—è–±—Ä—è 2025, 16:00  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞–π–¥–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–ò–∑ debug –≤—ã–≤–æ–¥–∞:**
```json
{
  "topics": ["–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞", ...],  ‚úÖ
  "speakers_summary": {"–ê–Ω–∞–ª–∏–∑": "–ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω..."},  ‚ö†Ô∏è
  "overall_summary": "–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–±—Å—É–¥–∏–ª–∏...",  ‚úÖ
  "message_count": 0,  ‚ùå (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 6)
  "period": "24 hours"  ‚ùå (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "6 hours")
}
```

**–°–∏–º–ø—Ç–æ–º—ã:**
- ‚úÖ –¢–µ–º—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (Agent 1 —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ Overall summary —Ä–∞–±–æ—Ç–∞–µ—Ç (Agent 3 —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚ö†Ô∏è Speakers –ø—É—Å—Ç–æ–π (Agent 2 —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è GigaChat)
- ‚ùå `message_count: 0` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- ‚ùå `period: "24 hours"` –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–≥–æ

---

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ n8n workflow:**

1. **Prepare Prompts** —Å–æ–∑–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
   ```javascript
   {
     user_id: 19,
     hours: 6,
     message_count: 6,
     topic_prompt: "...",
     speaker_prompt: "...",
     summary_prompt: "..."
   }
   ```

2. **Agents 1-3** –¥–µ–ª–∞—é—Ç HTTP Request –∏ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç** –¥–∞–Ω–Ω—ã–µ:
   ```javascript
   {
     choices: [{message: {content: "..."}}]
   }
   ```
   **‚Üê user_id, hours, message_count –ü–û–¢–ï–†–Ø–ù–´!**

3. **Merge Agent Responses** –ø—ã—Ç–∞–ª—Å—è –Ω–∞–π—Ç–∏ `item.json.user_id` –Ω–æ –µ–≥–æ —Ç–∞–º –Ω–µ—Ç!

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –§–∞–π–ª: `n8n/workflows/group_dialogue_multi_agent_v2.json`

#### 1. Prepare Prompts Node

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```javascript
// –ë–´–õ–û:
const limitedMessages = messages.slice(0, maxMessages);
message_count: limitedMessages.length,  // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!

// –°–¢–ê–õ–û:
const messageCount = messages.length;  // –†–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
const limitedMessages = messages.slice(0, maxMessages);
message_count: messageCount,  // –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
```

#### 2. Merge Agent Responses Node

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```javascript
// –ë–´–õ–û:
for (const item of items) {
  if (item.json.user_id !== undefined) {  // –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç!
    originalData = {...};
  }
}

// –°–¢–ê–õ–û:
const preparedData = $('Prepare Prompts').first().json;  // –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø!
const originalData = {
  user_id: preparedData.user_id,
  hours: preparedData.hours,
  message_count: preparedData.message_count
};
```

**–õ–æ–≥–∏–∫–∞:** –í–º–µ—Å—Ç–æ –ø–æ–∏—Å–∫–∞ –≤ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç HTTP Requests, –±–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ **–Ω–∞–ø—Ä—è–º—É—é –∏–∑ Prepare Prompts node**.

---

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ workflow –≤ n8n

1. **–û—Ç–∫—Ä–æ–π—Ç–µ n8n UI:** `https://n8n.produman.studio`

2. **–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–π:**
   - Workflows ‚Üí "Group Dialogue Multi-Agent Analyzer v2"
   - Active ‚Üí **OFF**

3. **–£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - Delete workflow

4. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π:**
   - Workflows ‚Üí **Import from File**
   - –§–∞–π–ª: `n8n/workflows/group_dialogue_multi_agent_v2.json`
   - Import

5. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π workflow
   - Active ‚Üí **ON** (–∑–µ–ª–µ–Ω—ã–π)
   - Save

---

### –®–∞–≥ 2: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ

**–í Telegram –±–æ—Ç–µ:**
```
/debug_group_digest 6
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "topics": ["—Ç–µ–º–∞1", "—Ç–µ–º–∞2", ...],
  "speakers_summary": {...},
  "overall_summary": "...",
  "message_count": 6,  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
  "period": "6 hours"  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!
}
```

**–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
# üìä –î–∞–π–¥–∂–µ—Å—Ç –≥—Ä—É–ø–ø—ã: Core Banking design team
–ü–µ—Ä–∏–æ–¥: 6 hours  ‚Üê ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥!
–°–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 6  ‚Üê ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:
1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ iOS
...

## üìù –†–µ–∑—é–º–µ:
–£—á–∞—Å—Ç–Ω–∏–∫–∏ –æ–±—Å—É–¥–∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞...
```

---

## üìä –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

| –ü–æ–ª–µ | –ë–´–õ–û | –°–¢–ê–õ–û |
|------|------|-------|
| **message_count** | 0 ‚ùå | 6 ‚úÖ |
| **period** | "24 hours" ‚ùå | "6 hours" ‚úÖ |
| **topics** | ‚úÖ –†–∞–±–æ—Ç–∞–ª–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **overall_summary** | ‚úÖ –†–∞–±–æ—Ç–∞–ª–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **speakers_summary** | ‚ö†Ô∏è –§–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è | ‚ö†Ô∏è –§–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è (GigaChat) |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –æ speakers_summary:**
- Agent 2 (Speaker Analyzer) –∏–Ω–æ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è GigaChat
- –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏, –Ω–µ –±–∞–≥ workflow
- Fallback: "–ê–Ω–∞–ª–∏–∑ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º—ã"

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–∞–ª–∏

### –ü–æ—á–µ–º—É $('Prepare Prompts').first().json —Ä–∞–±–æ—Ç–∞–µ—Ç?

–í n8n –∫–∞–∂–¥—ã–π node –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö nodes —á–µ—Ä–µ–∑:
- `$input.all()` - –¥–∞–Ω–Ω—ã–µ –æ—Ç –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–¥—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤
- `$('Node Name').first().json` - –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ node

**–ü—Ä–æ–±–ª–µ–º–∞ —Å HTTP Request:**
```
Prepare Prompts ‚Üí Agent 1 (HTTP Request)
    ‚Üì                    ‚Üì
{user_id, hours}    {choices: [...]} ‚Üê –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ—Ç–µ—Ä—è–Ω—ã!
```

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø:**
```
Merge Agent Responses ‚Üí $('Prepare Prompts').first().json
                            ‚Üì
                     {user_id, hours} ‚Üê –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω—ã!
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ workflow –∞–∫—Ç–∏–≤–µ–Ω
curl https://n8n.produman.studio/api/v1/workflows | jq '.[] | select(.name | contains("Group Dialogue"))'

# 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –±–æ—Ç–µ
/debug_group_digest 6

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—ã—á–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç
/group_digest 6
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- ‚úÖ `message_count` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
- ‚úÖ `period` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–º—É hours
- ‚úÖ –¢–µ–º—ã –∏–∑–≤–ª–µ—á–µ–Ω—ã
- ‚úÖ –†–µ–∑—é–º–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

---

## üìù Changelog

**v2.1 (13.10.2025 16:00):**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è `message_count` –∏ `hours`
- ‚úÖ Prepare Prompts —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `messages.length` –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞
- ‚úÖ Merge Agent Responses –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `$('Prepare Prompts').first().json`
- ‚úÖ Format Final Response –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–§–∞–π–ª:** `n8n/workflows/group_dialogue_multi_agent_v2.json`

---

**–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ!** üöÄ

