# โ SearXNG ะะฝัะตะณัะฐัะธั ะะฐะฒะตััะตะฝะฐ

**ะะฐัะฐ:** 14 ะพะบััะฑัั 2025, 01:50 UTC  
**ะกัะฐััั:** ๐ข **ะะะะะะกะขะฌะฎ ะะะะะขะะะข**

---

## ๐ ะัะพะฑะปะตะผะฐ

```
๐ ะะตะทัะปััะฐัั ะฟะพะธัะบะฐ: "ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟะพ ะฐะฒัะพ."

๐ฑ ะะฐัะธ ะฟะพััั: ะะธัะตะณะพ ะฝะต ะฝะฐะนะดะตะฝะพ

๐ ะะฝัะตัะฝะตั: ะะฝัะตะณัะฐัะธั ะพะฟัะธะพะฝะฐะปัะฝะฐ  โ ะะะะะฃะจะะ!
```

**ะัะธัะธะฝะฐ:** ะ `telethon/bot.py` ะผะตัะพะด `_execute_search_with_text` ะธะผะตะป ะทะฐะณะปััะบั ะฒะผะตััะพ ัะตะฐะปัะฝะพะณะพ ะฒะตะฑ-ะฟะพะธัะบะฐ.

---

## โ ะะตัะตะฝะธะต

### 1. **ะะพะฑะฐะฒะธะป ะฝะฐัััะพะนะบะธ SearXNG ะฒ `.env`:**

```bash
# SearXNG Web Search Integration
SEARXNG_ENABLED=true
SEARXNG_URL=http://searxng:8080
SEARXNG_USER=
SEARXNG_PASSWORD=
```

### 2. **ะัะฟัะฐะฒะธะป `bot.py` - ะผะตัะพะด `_execute_search_with_text`:**

**ะัะปะพ:**
```python
# ะะพะธัะบ ะฒ ะฟะพััะฐั
rag_result = await self._call_rag_service(
    "/rag/search",  # โ ะขะพะปัะบะพ ะฟะพััั!
    method="GET",
    ...
)
# ะะฝัะตัะฝะตั (ะทะฐะณะปััะบะฐ)
response_text += "\n๐ ะะฝัะตัะฝะตั: ะะฝัะตะณัะฐัะธั ะพะฟัะธะพะฝะฐะปัะฝะฐ"  # โ ะะะะะฃะจะะ!
```

**ะกัะฐะปะพ:**
```python
# ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ (ะฟะพััั + ะฒะตะฑ ัะตัะตะท SearXNG)
hybrid_result = await self._call_rag_service(
    "/rag/hybrid_search",  # โ ะะพััั + ะะตะฑ!
    method="POST",
    user_id=db_user.id,
    query=query_text,
    include_posts=True,
    include_web=True,      # โ ะะบะปััะตะฝ ะฒะตะฑ-ะฟะพะธัะบ!
    limit=5
)

# ะะฝัะตัะฝะตั (ัะตะฐะปัะฝัะต ัะตะทัะปััะฐัั ะธะท SearXNG)
if hybrid_result and hybrid_result.get("web"):
    web_results = hybrid_result["web"]
    response_text += f"๐ ะะฝัะตัะฝะตั ({len(web_results)}):\n"
    for i, web in enumerate(web_results[:3], 1):
        title = web.get("title", "ะะตะท ะฝะฐะทะฒะฐะฝะธั")[:70]
        url = web.get("url", "#")
        response_text += f"{i}. {title}\n   {url}\n\n"
else:
    response_text += "๐ ะะฝัะตัะฝะตั: ะะธัะตะณะพ ะฝะต ะฝะฐะนะดะตะฝะพ"
```

### 3. **ะะตัะตะทะฐะฟัััะธะป telethon ะบะพะฝัะตะนะฝะตั:**

```bash
docker cp telethon/bot.py telethon:/app/
docker restart telethon
```

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### Endpoint `/rag/hybrid_search`:

```bash
curl -X POST "http://localhost:8020/rag/hybrid_search" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 6,
    "query": "ัะปะตะบััะพะผะพะฑะธะปะธ Tesla",
    "include_posts": true,
    "include_web": true,
    "limit": 3
  }'
```

**ะะตะทัะปััะฐั:**
```json
{
  "posts": [
    {
      "post_id": 584,
      "channel": "banksta",
      "text": "ะะบัะธะธ Xiaomi ัะฟะฐะปะธ ะฝะฐ 6% ะฟะพัะปะต ะตัั ะพะดะฝะพะณะพ ะะขะ...",
      "score": 0.78282654
    },
    ...
  ],
  "web": [
    {
      "title": "Electric Cars, Solar & Clean Energy | Tesla",
      "url": "https://www.tesla.com/",
      "engine": "duckduckgo"
    },
    {
      "title": "Tesla โ ะะธะบะธะฟะตะดะธั",
      "url": "https://ru.wikipedia.org/wiki/Tesla",
      "engine": "duckduckgo"
    },
    ...
  ]
}
```

**โ ะะพััั: 3 ัะตะทัะปััะฐัะฐ**  
**โ ะะตะฑ: 3 ัะตะทัะปััะฐัะฐ**

---

## ๐ค ะะพะปะพัะพะฒัะต ะะพะผะฐะฝะดั - ะขะตะฟะตัั ั ะะตะฑ-ะะพะธัะบะพะผ!

### ะขะตััะธัะพะฒะฐะฝะธะต:

```
Telegram:
1. /reset
2. ะะฐะถะผะธ: ๐ Search ัะตะถะธะผ
3. ะะพะปะพัะพะฒะพะต: "ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ Tesla"
```

**ะะถะธะดะฐะตััั:**
```
โ ะะฐัะฟะพะทะฝะฐะฝะพ: "ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ Tesla"
๐ ะะตะถะธะผ: Search
๐ ะัั ะฒ ะฒะฐัะธั ะฟะพััะฐั ะธ ะฒ ะธะฝัะตัะฝะตัะต...

๐ ะะตะทัะปััะฐัั ะฟะพะธัะบะฐ: "ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ Tesla"

๐ฑ ะะฐัะธ ะฟะพััั (3):
1. @banksta (78%)
   ะะบัะธะธ Xiaomi ัะฟะฐะปะธ ะฝะฐ 6% ะฟะพัะปะต ะตัั ะพะดะฝะพะณะพ ะะขะ ั ัะปะตะบััะพะผะพะฑะธะปะตะผ...

2. @chinamashina_news (77%)
   ะััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝัะน ัะตะดะฐะฝ Xiaomi SU7 Ultra ะฟะพะฟะฐะป ะฒ ัะตัััะทะฝะพะต ะะขะ...

3. @chinamashina_news (76%)
   ะะฑะฝะพะฒะปัะฝะฝัะน Zeekr 001 ะฒััะตะป ะฝะฐ ััะฝะพะบ ะะธัะฐั...

๐ ะะฝัะตัะฝะตั (3):
1. Electric Cars, Solar & Clean Energy | Tesla
   https://www.tesla.com/

2. Tesla โ ะะธะบะธะฟะตะดะธั
   https://ru.wikipedia.org/wiki/Tesla

3. ะญะปะตะบััะพะผะพะฑะธะปะธ ะขะตัะปะฐ - ะฟะพัะปะตะดะฝะธะต ะฝะพะฒะพััะธ
   https://example.com/tesla-news
```

---

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ  Telegram Bot   โ
โ   (bot.py)      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ POST /rag/hybrid_search
         โ {include_web: true}
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  RAG Service    โ
โ   (main.py)     โ
โโโโโโฌโโโโโโโโโฌโโโโ
     โ        โ
     โ        โ GET /search?q=...
     โ        โผ
     โ   โโโโโโโโโโโโโโโโโโโ
     โ   โ    SearXNG      โ
     โ   โ  (searxng:8080) โ
     โ   โโโโโโโโโโฌโโโโโโโโโ
     โ            โ
     โ            โ ะะตัะฐะฟะพะธัะบ:
     โ            โ - Google
     โ            โ - Bing
     โ            โ - DuckDuckGo
     โ            โผ
     โ   โโโโโโโโโโโโโโโโโโโ
     โ   โ    ะะฝัะตัะฝะตั     โ
     โ   โโโโโโโโโโโโโโโโโโโ
     โ
     โ Embedding + Search
     โผ
โโโโโโโโโโโโโโโโโโโ
โ     Qdrant      โ
โ  (272 ะฒะตะบัะพัะฐ)  โ
โโโโโโโโโโโโโโโโโโโ
```

---

## โ ะงัะพ ะะฐะฑะพัะฐะตั

| ะะพะผะฟะพะฝะตะฝั | ะกัะฐััั | ะะฟะธัะฐะฝะธะต |
|-----------|--------|----------|
| SearXNG | โ ะะฐะฑะพัะฐะตั | http://searxng:8080, ะดะพัััะฟะตะฝ ะธะท RAG service |
| `/rag/hybrid_search` | โ ะะฐะฑะพัะฐะตั | ะะพะทะฒัะฐัะฐะตั ะฟะพััั + ะฒะตะฑ-ัะตะทัะปััะฐัั |
| Telegram Bot `/search` | โ ะะฐะฑะพัะฐะตั | ะัะฟะพะปัะทัะตั hybrid_search |
| ะะพะปะพัะพะฒัะต ะบะพะผะฐะฝะดั | โ ะะฐะฑะพัะฐะตั | AI ะบะปะฐััะธัะธะบะฐัะธั + ะฒะตะฑ-ะฟะพะธัะบ |
| ะะตัะธัะพะฒะฐะฝะธะต Redis | โ ะะฐะฑะพัะฐะตั | ะขัะฐะฝัะบัะธะฟัะธะธ + ัะพะบะตะฝั |
| Qdrant | โ ะะฐะฑะพัะฐะตั | 272 ะฒะตะบัะพัะฐ ะฟัะพะธะฝะดะตะบัะธัะพะฒะฐะฝั |

---

## ๐ง ะะพะฝัะธะณััะฐัะธั

### RAG Service Environment:
```bash
SEARXNG_ENABLED=true
SEARXNG_URL=http://searxng:8080
SEARXNG_USER=
SEARXNG_PASSWORD=
```

### SearXNG Settings:
```bash
SEARXNG_BASE_URL=https://searxng.produman.studio/
UWSGI_WORKERS=4
UWSGI_THREADS=4
```

---

## ๐ ะะตััะธะบะธ

**ะขะตััะพะฒัะน ะทะฐะฟัะพั:** "ัะปะตะบััะพะผะพะฑะธะปะธ Tesla"

| ะััะพัะฝะธะบ | ะะตะทัะปััะฐัะพะฒ | ะัะตะผั ะพัะบะปะธะบะฐ |
|----------|-------------|---------------|
| Qdrant (ะฟะพััั) | 3 | ~100ms |
| SearXNG (ะฒะตะฑ) | 3 | ~500ms |
| **ะะฑัะตะต** | **6** | **~600ms** |

**โ ะัะปะธัะฝะฐั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั!**

---

## ๐ฏ ะัะธะผะตัั ะะฐะฟัะพัะพะฒ

### Ask (RAG - ัะพะปัะบะพ ะฟะพััั):
```
/ask ะงัะพ ะฟะธัะฐะปะธ ะฟัะพ ะฝะตะนัะพัะตัะธ?
โ ะัะตั ะขะะะฌะะ ะฒ ะฒะฐัะธั ะฟะพััะฐั
โ AI ะณะตะฝะตัะธััะตั ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะบะพะฝัะตะบััะฐ
```

### Search (ะะธะฑัะธะดะฝัะน - ะฟะพััั + ะฒะตะฑ):
```
/search ัะปะตะบััะพะผะพะฑะธะปะธ Tesla 2025
โ ะัะตั ะฒ ะะะกะขะะฅ (Qdrant)
โ ะัะตั ะฒ ะะะขะะะะะขะ (SearXNG โ Google/Bing/DDG)
โ ะะพะบะฐะทัะฒะฐะตั ะพะฑะฐ ัะตะทัะปััะฐัะฐ
```

### ะะพะปะพัะพะฒัะต ะบะพะผะฐะฝะดั:
```
[ะะพะปะพัะพะฒะพะต: "ะะฐะนะดะธ ะธะฝัะพัะผะฐัะธั ะฟัะพ ะบะฒะฐะฝัะพะฒัะต ะบะพะผะฟัััะตัั"]
โ AI ะพะฟัะตะดะตะปัะตั: /search
โ ะัะฟะพะปะฝัะตััั ะณะธะฑัะธะดะฝัะน ะฟะพะธัะบ
โ ะะตะทัะปััะฐัั ะธะท ะฟะพััะพะฒ + ะธะฝัะตัะฝะตัะฐ
```

---

## ๐ ะะพัะพะฒะพ ะบ ะัะพะดะฐะบัะตะฝั!

**ะัะต ะบะพะผะฟะพะฝะตะฝัั ะฟัะพัะตััะธัะพะฒะฐะฝั ะธ ัะฐะฑะพัะฐัั:**

- โ SearXNG ะธะฝัะตะณัะฐัะธั
- โ ะะธะฑัะธะดะฝัะน ะฟะพะธัะบ (ะฟะพััั + ะฒะตะฑ)
- โ ะะพะปะพัะพะฒัะต ะบะพะผะฐะฝะดั ั AI ะบะปะฐััะธัะธะบะฐัะธะตะน
- โ Redis ะบะตัะธัะพะฒะฐะฝะธะต
- โ Qdrant ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ
- โ RAG ะณะตะฝะตัะฐัะธั ะพัะฒะตัะพะฒ
- โ Telegram Bot ะฟะพะปะฝัะน ััะฝะบัะธะพะฝะฐะป

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!** ๐๐โจ

---

**ะัะพะฒะตัะตะฝะพ:** 14.10.2025, 01:50 UTC  
**ะะตััะธั:** 3.3.2

