# ‚úÖ Voice Command Classifier - –ò–°–ü–†–ê–í–õ–ï–ù

**–î–∞—Ç–∞:** 13 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ –∏–º–ø–æ—Ä—Ç—É

---

## üêõ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. ‚ùå Header Auth —Ç—Ä–µ–±–æ–≤–∞–ª credentials
**–ü—Ä–æ–±–ª–µ–º–∞:**
```
Issues: Credentials for 'Header Auth' are not set.
```

**–†–µ—à–µ–Ω–∏–µ:**
```json
// –ë–´–õ–û:
"authentication": "predefinedCredentialType",
"nodeCredentialType": "httpHeaderAuth"

// –°–¢–ê–õ–û:
"authentication": "none"
```

‚úÖ **gpt2giga-proxy –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

---

### 2. ‚ùå Error Fallback –Ω–µ –±—ã–ª –ø–æ–¥–∫–ª—é—á–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£–∑–µ–ª "Error Fallback" —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª, –Ω–æ –Ω–∏ —Å —á–µ–º –Ω–µ —Å–æ–µ–¥–∏–Ω–µ–Ω
- –ó–∞–Ω–∏–º–∞–ª –º–µ—Å—Ç–æ –≤ workflow –±–µ–∑ –ø–æ–ª—å–∑—ã

**–†–µ—à–µ–Ω–∏–µ:**
- –£–¥–∞–ª–µ–Ω —É–∑–µ–ª "Error Fallback"
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ **—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** –≤ —É–∑–ª–µ "Parse & Validate":

```javascript
try {
  // –ü–∞—Ä—Å–∏–º GigaChat –æ—Ç–≤–µ—Ç
  const result = JSON.parse(cleaned);
  return { command, confidence, reasoning };
} catch (e) {
  // ‚úÖ Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç–≤—Ä–∏—Å—Ç–∏–∫—É
  const isSearch = searchKeywords.some(kw => transcription.includes(kw));
  return {
    command: isSearch ? 'search' : 'ask',
    confidence: 0.6,
    reasoning: 'Fallback: GigaChat parsing failed, used heuristics'
  };
}
```

‚úÖ **–ï—Å–ª–∏ GigaChat –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞**

---

## üìã –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow:

```
Webhook (POST /webhook/voice-classify)
    ‚Üì
Extract Input (transcription, user_id)
    ‚Üì
Prepare Prompt (—Å–æ–∑–¥–∞–µ—Ç prompt –¥–ª—è GigaChat)
    ‚Üì
GigaChat Classify (HTTP POST –∫ gpt2giga-proxy) [‚úÖ –ë–ï–ó AUTH]
    ‚Üì
Parse & Validate (–ø–∞—Ä—Å–∏–Ω–≥ + —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ fallback) [‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö]
    ‚Üì
Respond to Webhook (JSON: command, confidence, reasoning)
```

**–í—Å–µ–≥–æ —É–∑–ª–æ–≤:** 6 (–±—ã–ª–æ 7)  
**–í—Å–µ —É–∑–ª—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã:** ‚úÖ  
**Credentials —Ç—Ä–µ–±—É—é—Ç—Å—è:** ‚ùå –ù–ï–¢

---

## üöÄ –ì–æ—Ç–æ–≤ –∫ –∏–º–ø–æ—Ä—Ç—É

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç –≤ n8n

```bash
# 1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5678
# 2. –ù–∞–∂–º–∏—Ç–µ "+" ‚Üí "Import from File"
# 3. –í—ã–±–µ—Ä–∏—Ç–µ: n8n/workflows/voice_command_classifier.json
# 4. –ù–∞–∂–º–∏—Ç–µ "Import"
```

‚úÖ **Credentials –ù–ï —Ç—Ä–µ–±—É—é—Ç—Å—è!**

### –®–∞–≥ 2: –ê–∫—Ç–∏–≤–∞—Ü–∏—è

```bash
# –í n8n –æ—Ç–∫—Ä–æ–π—Ç–µ workflow
# –ù–∞–∂–º–∏—Ç–µ "Active" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
# –î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –∑–µ–ª–µ–Ω—ã–π —Å—Ç–∞—Ç—É—Å ‚úÖ
```

### –®–∞–≥ 3: –¢–µ—Å—Ç

```bash
curl -X POST http://localhost:5678/webhook/voice-classify \
  -H "Content-Type: application/json" \
  -d '{
    "transcription": "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?",
    "user_id": 1
  }'
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```json
{
  "command": "ask",
  "confidence": 0.95,
  "reasoning": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å, —Ç—Ä–µ–±—É—é—â–∏–π RAG –ø–æ–∏—Å–∫–∞",
  "original_transcription": "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?",
  "user_id": 1
}
```

---

## üß™ –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Telegram

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ **–ë–ï–ó** –∫–æ–º–∞–Ω–¥—ã `/ask` –∏–ª–∏ `/search`
2. –°–∫–∞–∂–∏—Ç–µ: "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?"

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```
‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?"

ü§ñ AI –≤—ã–±—Ä–∞–ª: /ask (95% —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏)
üîç –í—ã–ø–æ–ª–Ω—è—é...

üí° –û—Ç–≤–µ—Ç: [–≤–∞—à RAG –æ—Ç–≤–µ—Ç]
```

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: GigaChat –æ—Ç–≤–µ—á–∞–µ—Ç (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º)

```
GigaChat ‚Üí {"command": "ask", "confidence": 0.95}
Bot ‚Üí –í—ã–ø–æ–ª–Ω—è–µ—Ç /ask
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: GigaChat timeout –∏–ª–∏ –æ—à–∏–±–∫–∞ (fallback)

```
GigaChat ‚Üí ERROR –∏–ª–∏ timeout
Parse & Validate ‚Üí –≠–≤—Ä–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
  "–Ω–∞–π–¥–∏" ‚Üí /search (confidence: 0.6)
  "—á—Ç–æ —Ç–∞–∫–æ–µ" ‚Üí /search
  –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí /ask
Bot ‚Üí –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: n8n –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (bot fallback)

```
Bot ‚Üí n8n –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
Bot ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞:
  [üí° /ask] [üîç /search]
User ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç –≤—Ä—É—á–Ω—É—é
```

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** 3 —É—Ä–æ–≤–Ω—è fallback! ‚úÖ

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞

### ‚úÖ Checklist:

- [ ] Workflow –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ n8n
- [ ] –°—Ç–∞—Ç—É—Å "Active" ‚úÖ (–∑–µ–ª–µ–Ω—ã–π)
- [ ] **–ù–ï–¢** –æ—à–∏–±–æ–∫ "Credentials required"
- [ ] **–í–°–ï** —É–∑–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω—ã (–Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –≤–∏—Å—è—â–∏—Ö)
- [ ] Webhook –¥–æ—Å—Ç—É–ø–µ–Ω (`curl` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON)
- [ ] Telegram –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é

---

## üêõ Troubleshooting

### ‚ùå "Credentials for 'Header Auth' are not set"

**–ù–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è!** –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–æ—Å—å:
1. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–π workflow –∏–∑ n8n
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π `voice_command_classifier.json`

### ‚ùå "Referenced node doesn't exist"

**–†–µ—à–µ–Ω–∏–µ:**
- –≠—Ç–æ —Å—Ç–∞—Ä–∞—è –æ—à–∏–±–∫–∞, –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å –ø–æ—Å–ª–µ —Ä–µ–∏–º–ø–æ—Ä—Ç–∞

### ‚ùå –£–∑–µ–ª "Error Fallback" –≤–∏—Å–∏—Ç –æ—Ç–¥–µ–ª—å–Ω–æ

**–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!** –ï—Å–ª–∏ –µ—Å—Ç—å:
- –£–¥–∞–ª–∏—Ç–µ workflow
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª

---

**–ì–û–¢–û–í–û!** üéâ Workflow –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤ n8n –∏ —Ç–µ—Å—Ç–∏—Ä—É–π! üöÄ

