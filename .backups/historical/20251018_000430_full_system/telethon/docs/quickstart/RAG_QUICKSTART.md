# RAG System - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## –ß—Ç–æ —ç—Ç–æ?

RAG (Retrieval-Augmented Generation) - —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Å—Ç–æ–≤ –∏–∑ Telegram –∫–∞–Ω–∞–ª–æ–≤.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üîç –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–∞–º (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + keyword)
- ü§ñ –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å—Ç–æ–≤ (RAG)
- üì∞ AI-–¥–∞–π–¥–∂–µ—Å—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π
- üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üåê –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ—Å—Ç—ã + –≤–µ–± —á–µ—Ä–µ–∑ Searxng)
- üìÑ –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —Å—Å—ã–ª–æ–∫ (Crawl4AI)

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- **Qdrant** - –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è embeddings
- **Redis** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings (TTL 24h) –∏ RAG-–æ—Ç–≤–µ—Ç–æ–≤ (TTL 1h)
- **GigaChat** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings (EmbeddingsGigaR)
- **OpenRouter/GigaChat** - LLM –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
- **Searxng** - –º–µ—Ç–∞–ø–æ–∏—Å–∫–æ–≤–∏–∫ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Crawl4AI** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü
- **Ollama** - –ª–æ–∫–∞–ª—å–Ω—ã–µ LLM –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **n8n/Flowise** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ webhooks

## Telegram –±–æ—Ç - –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ RAG:

```
/ask <–≤–æ–ø—Ä–æ—Å>          - –ü–æ–∏—Å–∫ –æ—Ç–≤–µ—Ç–∞ –≤ –ø–æ—Å—Ç–∞—Ö
/digest                - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI-–¥–∞–π–¥–∂–µ—Å—Ç–æ–≤
/recommend             - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
/search <–∑–∞–ø—Ä–æ—Å>       - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ—Å—Ç—ã + web)
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```
/ask –ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?
/ask –ö–∞–∫–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ Tesla?
/search –±–ª–æ–∫—á–µ–π–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker ps | grep -E "telethon|rag-service|gpt2giga|qdrant"

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã:
# - telethon
# - rag-service
# - gpt2giga-proxy
# - qdrant (–µ—Å–ª–∏ –µ—Å—Ç—å)
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ RAG-—Å–µ—Ä–≤–∏—Å–∞

```bash
# Health check
curl http://localhost:8020/health

# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
open http://localhost:8020/docs
```

### 3. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:** –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞.

**–í—Ä—É—á–Ω—É—é:**
```bash
# –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–º–µ–Ω–∏—Ç–µ 1 –Ω–∞ –≤–∞—à user_id)
curl -X POST "http://localhost:8020/rag/index/user/1"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
curl "http://localhost:8020/rag/stats/1"
```

### 4. –ü–æ–∏—Å–∫

```bash
# –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫
curl "http://localhost:8020/rag/search?query=–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π+–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç&user_id=1&limit=5"

# –° —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
curl "http://localhost:8020/rag/search?query=AI&user_id=1&tags=—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏&limit=10"
```

### 5. –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å (RAG)

```bash
curl -X POST http://localhost:8020/rag/ask \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?",
    "user_id": 1,
    "context_limit": 10
  }'
```

### 6. –î–∞–π–¥–∂–µ—Å—Ç

```bash
# –î–∞–π–¥–∂–µ—Å—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
curl -X POST http://localhost:8020/rag/digest/generate \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "date_from": "2025-01-05T00:00:00Z",
    "date_to": "2025-01-11T23:59:59Z",
    "format": "markdown",
    "max_posts": 20
  }'
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n

### Webhook –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤

–î–æ–±–∞–≤—å—Ç–µ –≤ n8n webhook –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤:

```
URL: http://rag-service:8020/rag/index/batch
Method: POST
Body: {"post_ids": [1, 2, 3]}
```

### Workflow: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç

1. **Trigger:** Schedule (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00)
2. **HTTP Request:** POST –∫ `/rag/digest/generate`
3. **Send to Telegram:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç –≤ –∫–∞–Ω–∞–ª/—á–∞—Ç

## AI-–¥–∞–π–¥–∂–µ—Å—Ç—ã —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç

```
/digest    # –û—Ç–∫—Ä–æ–µ—Ç –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

**–í—ã–±–æ—Ä –æ–ø—Ü–∏–π:**
- üìÖ –ß–∞—Å—Ç–æ—Ç–∞: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ / –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
- üïê –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: 09:00 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- ü§ñ AI-—Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è: –≤–∫–ª/–≤—ã–∫–ª
- üìä –°—Ç–∏–ª—å: –∫—Ä–∞—Ç–∫–∏–π / –¥–µ—Ç–∞–ª—å–Ω—ã–π / executive
- üè∑Ô∏è –¢–µ–º—ã: —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã—Ö —Ç–µ–º

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

RAG –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **–∏—Å—Ç–æ—Ä–∏—é –≤–∞—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π:

```python
# 1. –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–º—ã –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
/ask —á—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö?
/ask –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ Tesla
‚Üí –¢–µ–º—ã: [–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, Tesla, –∞–≤—Ç–æ–º–æ–±–∏–ª–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏]

# 2. –ò—â–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø–æ—Å—Ç—ã –ø–æ —Ç–µ–º–∞–º
‚Üí 10 –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã
‚Üí 10 –ø–æ—Å—Ç–æ–≤ –ø—Ä–æ Tesla
‚Üí ...

# 3. AI —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è
‚Üí –ö—Ä–∞—Ç–∫–∏–π –¥–∞–π–¥–∂–µ—Å—Ç —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏ –ø–æ –≤–∞—à–∏–º –∏–Ω—Ç–µ—Ä–µ—Å–∞–º
```

### API –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI-–¥–∞–π–¥–∂–µ—Å—Ç–∞
curl -X POST http://localhost:8020/rag/digest/settings/1 \
  -H "Content-Type: application/json" \
  -d '{
    "enabled": true,
    "ai_summarize": true,
    "frequency": "daily",
    "time": "09:00",
    "preferred_topics": ["AI", "–±–ª–æ–∫—á–µ–π–Ω", "—Å—Ç–∞—Ä—Ç–∞–ø—ã"],
    "summary_style": "concise",
    "max_posts": 50
  }'

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–∞
curl -X POST http://localhost:8020/rag/digest/generate/1
```

## –†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ:**
- Embeddings –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 24 —á–∞—Å–∞
- RAG-–æ—Ç–≤–µ—Ç—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –Ω–∞ 1 —á–∞—Å

**–†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ embeddings
docker exec redis redis-cli -a LOCALONLYREDIS KEYS "embedding:*" | xargs docker exec redis redis-cli -a LOCALONLYREDIS DEL

# –û—á–∏—Å—Ç–∫–∞ RAG-–æ—Ç–≤–µ—Ç–æ–≤
docker exec redis redis-cli -a LOCALONLYREDIS KEYS "rag:*" | xargs docker exec redis redis-cli -a LOCALONLYREDIS DEL

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
docker exec redis redis-cli -a LOCALONLYREDIS INFO stats
```

### Searxng (–≤–µ–±-–ø–æ–∏—Å–∫)

**–í–∫–ª—é—á–µ–Ω–∏–µ:**
```bash
# –í .env
SEARXNG_ENABLED=true
SEARXNG_URL=https://searxng.produman.studio
SEARXNG_USER=hello@ilyasni.com
SEARXNG_PASSWORD=your_password
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç:**
```
/search –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã
‚Üí –ò—â–µ—Ç –≤ –≤–∞—à–∏—Ö –ø–æ—Å—Ç–∞—Ö + –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ Searxng
```

**API:**
```bash
curl -X POST http://localhost:8020/rag/hybrid_search \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "query": "–∫–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã",
    "include_web": true
  }'
```

### Crawl4AI (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ:**
–ö–æ–≥–¥–∞ –ø–æ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É, Crawl4AI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç:

```python
# –ü–æ—Å—Ç —Å —Å—Å—ã–ª–∫–æ–π
"–û—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç—å—è –ø—Ä–æ AI: https://example.com/ai-article"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Å—ã–ª–∫–∏
‚Üí –°—Ç–∞—Ç—å—è –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –ø–æ—Å—Ç–æ–º
‚Üí –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ RAG
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
# –í .env
CRAWL4AI_ENABLED=true
CRAWL4AI_URL=http://crawl4ai:11235
CRAWL4AI_TIMEOUT=30
CRAWL4AI_WORD_THRESHOLD=100    # –ú–∏–Ω–∏–º—É–º —Å–ª–æ–≤ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
```

### Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–µ LLM)

**Use case:** –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
# –í .env
OLLAMA_ENABLED=true
OLLAMA_URL=http://ollama:11434
OLLAMA_DEFAULT_MODEL=llama3.2
```

**API:**
```bash
# –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –æ–±–ª–∞–∫–æ)
curl -X POST http://localhost:8020/rag/anonymize \
  -H "Content-Type: application/json" \
  -d '{
    "text": "–ú–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ +79001234567",
    "user_id": 1
  }'
```

## Troubleshooting

### RAG-—Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker logs rag-service

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose up rag-service --build -d
```

### Qdrant –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Qdrant
curl http://localhost:6333/collections

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ –≤ .env
grep QDRANT_API_KEY telethon/.env
```

### Embeddings –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ gpt2giga-proxy
docker logs gpt2giga-proxy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ RAG –ª–æ–≥–∞—Ö
docker logs rag-service | grep "embedding"
```

### RAG –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ OPENROUTER_API_KEY
docker logs rag-service | grep "OPENROUTER"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ https://openrouter.ai/
```

### –ü–æ—Å—Ç—ã –Ω–µ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è

```bash
# –†—É—á–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
curl -X POST "http://localhost:8020/rag/index/user/YOUR_USER_ID"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl "http://localhost:8020/rag/stats/YOUR_USER_ID"
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (.env)

```bash
# Qdrant
QDRANT_API_KEY=your_qdrant_api_key

# OpenRouter (–¥–ª—è RAG)
OPENROUTER_API_KEY=your_openrouter_api_key

# GigaChat (–¥–ª—è embeddings)
GIGACHAT_CREDENTIALS=your_gigachat_credentials

# RAG –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RAG_TOP_K=10                    # –ö–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
RAG_MIN_SCORE=0.7               # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π score —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
RAG_CONTEXT_WINDOW=4000         # –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (tokens)
```

### Chunking (–¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤)

```bash
# GigaChat embeddings
EMBEDDING_MAX_TOKENS_GIGACHAT=1536      # –ú–∞–∫—Å. —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ chunk
EMBEDDING_OVERLAP_TOKENS_GIGACHAT=256   # Overlap –º–µ–∂–¥—É chunks

# Sentence-transformers (fallback)
EMBEDDING_MAX_TOKENS_FALLBACK=384
EMBEDDING_OVERLAP_TOKENS_FALLBACK=64
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python

```python
import httpx

async def search_posts(query: str, user_id: int):
    async with httpx.AsyncClient() as client:
        response = await client.get(
            "http://localhost:8020/rag/search",
            params={"query": query, "user_id": user_id, "limit": 5}
        )
        return response.json()

async def ask_question(query: str, user_id: int):
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "http://localhost:8020/rag/ask",
            json={"query": query, "user_id": user_id}
        )
        return response.json()
```

### JavaScript (n8n)

```javascript
// n8n HTTP Request node
const options = {
  method: 'POST',
  url: 'http://rag-service:8020/rag/ask',
  body: {
    query: $json.question,
    user_id: $json.user_id,
    context_limit: 10
  }
};

return $http(options);
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **API Docs:** http://localhost:8020/docs
- **Qdrant UI:** https://qdrant.produman.studio
- **OpenRouter:** https://openrouter.ai/
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `/home/ilyasni/n8n-server/n8n-installer/telethon/docs/`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤–∞—à–∏—Ö –ø–æ—Å—Ç–æ–≤
2. ‚úÖ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∏—Å–∫
3. ‚úÖ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ RAG
4. ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–∞–π–¥–∂–µ—Å—Ç
5. üì± –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Telegram –±–æ—Ç–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
6. üîß –ù–∞—Å—Ç—Ä–æ–π—Ç–µ n8n workflows
7. üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –ª–æ–≥–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–í–æ–ø—Ä–æ—Å—ã? –°–º–æ—Ç—Ä–∏—Ç–µ:
- `telethon/rag_service/README.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `telethon/RAG_IMPLEMENTATION_SUMMARY.md` - –æ—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –õ–æ–≥–∏: `docker logs rag-service`

