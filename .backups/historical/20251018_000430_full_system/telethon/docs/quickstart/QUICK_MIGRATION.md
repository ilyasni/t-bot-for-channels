# –ë—ã—Å—Ç—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∫ Many-to-Many —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

‚úÖ –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –≤ –ë–î  
‚úÖ –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–¥–∏–Ω –∫–∞–Ω–∞–ª  
‚úÖ –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞ –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 –∫–æ–º–∞–Ω–¥—ã)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
pkill -f "python.*main.py"
pkill -f "python.*bot.py"
pkill -f "python.*run_system.py"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
cd /home/ilyasni/n8n-server/n8n-installer/telethon
python3 migrate_to_many_to_many.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –æ–±—Ä–∞—Ç–Ω–æ
python3 run_system.py &
```

## üìã –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è?

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
```
@durov –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º A ‚Üí –∑–∞–ø–∏—Å—å 1 –≤ channels
@durov –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º B ‚Üí –∑–∞–ø–∏—Å—å 2 –≤ channels (–¥—É–±–ª–∏–∫–∞—Ç!)
```

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```
@durov ‚Üí –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ channels
‚îú‚îÄ‚îÄ –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A
‚îî‚îÄ‚îÄ –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤
sqlite3 telegram.db "SELECT COUNT(*) FROM channels;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫
sqlite3 telegram.db "SELECT COUNT(*) FROM user_channel;"

# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
sqlite3 telegram.db "SELECT channel_username, COUNT(*) as cnt FROM channels GROUP BY channel_username HAVING cnt > 1;"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ!
```

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞
cp telegram.db.backup_* telegram.db

# –ò–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–Ω–Ω—ã–π –±—ç–∫–∞–ø
cp /path/to/your/backup.db telegram.db
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ!

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã** –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
2. **–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** (–¥–ª—è SQLite)
3. **–ú–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞** - –≤—Å–µ –ø–æ—Å—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
4. **–ó–∞–Ω–∏–º–∞–µ—Ç 1-5 —Å–µ–∫—É–Ω–¥** –Ω–∞ –æ–±—ã—á–Ω–æ–π –ë–î

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```
üîÑ –ù–∞—á–∏–Ω–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã user_channel...
‚úÖ –¢–∞–±–ª–∏—Ü–∞ user_channel —Å–æ–∑–¥–∞–Ω–∞
üìã –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö...
üìä –ù–∞–π–¥–µ–Ω–æ 150 –∑–∞–ø–∏—Å–µ–π –≤ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
üìã –®–∞–≥ 3: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤...
üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 80 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
...
‚úÖ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û
üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤: 80
  - –ü–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 150
  - –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: 70
```

## üìû –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤—ã–≤–æ–¥—è—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –±—ç–∫–∞–ø–∞
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ `MIGRATION_MANY_TO_MANY.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π

## üöÄ –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ! –ë–æ—Ç—ã –∏ API –Ω–µ —Ç—Ä–µ–±—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ: —Ç–µ–ø–µ—Ä—å –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –µ—Å—Ç—å —É –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç.

