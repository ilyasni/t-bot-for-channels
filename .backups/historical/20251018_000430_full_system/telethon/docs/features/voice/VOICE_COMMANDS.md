# üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã - Voice Commands

**–í–µ—Ä—Å–∏—è:** 3.3.0  
**–î–∞—Ç–∞:** 13 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–î–æ—Å—Ç—É–ø:** Premium/Enterprise only

---

## üéØ –û–±–∑–æ—Ä

–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/ask` –∏ `/search` —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (OGG, –¥–æ 60s)
    ‚Üì
SaluteSpeech API (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏)
    ‚Üì
–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≤ —Ç–µ–∫—Å—Ç
    ‚Üì
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ /ask –∏–ª–∏ /search —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
    ‚Üì
–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- [SaluteSpeech API](https://developers.sber.ru/docs/ru/salutespeech/overview) - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –æ—Ç Sber
- Redis - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π (24 —á–∞—Å–∞)
- OAuth2 - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. /ask —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤–æ–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```
User: /ask
Bot: üí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /ask <–≤–æ–ø—Ä–æ—Å>
     üé§ Premium: –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!

User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ: "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?"]
Bot: üé§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≥–æ–ª–æ—Å–æ–≤–æ–µ (5s)...
     ‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-10 —Å–µ–∫—É–Ω–¥

Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?"
     üîç –í—ã–ø–æ–ª–Ω—è—é /ask...

Bot: üí° –û—Ç–≤–µ—Ç: –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –æ–±—Å—É–∂–¥–∞–ª–∏...
     üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏: [AI News] (95%)
```

### 2. /search —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤–æ–µ

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
```
User: /search
Bot: üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: /search <–∑–∞–ø—Ä–æ—Å>
     üé§ Premium: –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!

User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ: "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"]
Bot: üé§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é...

Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"
     üîç –í—ã–ø–æ–ª–Ω—è—é /search...

Bot: üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
     üì± –í–∞—à–∏ –ø–æ—Å—Ç—ã (3)
     üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç (5)
```

### 3. –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**üìå –°–ø–æ—Å–æ–± 1: –ö–æ–º–∞–Ω–¥–∞ ‚Üí –ì–æ–ª–æ—Å–æ–≤–æ–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```
User: /ask              # –í—ã–±–∏—Ä–∞–µ–º –∫–æ–º–∞–Ω–¥—É
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ]       # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
Bot: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç /ask

User: /search           # –í—ã–±–∏—Ä–∞–µ–º –¥—Ä—É–≥—É—é –∫–æ–º–∞–Ω–¥—É
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ]       # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
Bot: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç /search
```

**üìå –°–ø–æ—Å–æ–± 2: –ì–æ–ª–æ—Å–æ–≤–æ–µ ‚Üí –í—ã–±–æ—Ä –∫–Ω–æ–ø–∫–∏**
```
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã]
Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–í–∞—à —Ç–µ–∫—Å—Ç"
     ü§î –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
     [üí° /ask - RAG –ø–æ–∏—Å–∫]
     [üîç /search - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫]

User: [–Ω–∞–∂–∏–º–∞–µ—Ç –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É]
Bot: –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É
```

---

## üíé –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –ª–∏–º–∏—Ç—ã

### Free Tier
- ‚ùå –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã **–ù–ï –¥–æ—Å—Ç—É–ø–Ω—ã**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### Trial (7 –¥–Ω–µ–π)
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã **–¥–æ—Å—Ç—É–ø–Ω—ã**
- –õ–∏–º–∏—Ç: **20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å**
- –ú–∞–∫—Å–∏–º—É–º: 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ

### Basic
- ‚ùå –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã **–ù–ï –¥–æ—Å—Ç—É–ø–Ω—ã**
- –û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ Premium

### Premium
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã **–¥–æ—Å—Ç—É–ø–Ω—ã**
- –õ–∏–º–∏—Ç: **50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å**
- –ú–∞–∫—Å–∏–º—É–º: 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ

### Enterprise
- ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã **–¥–æ—Å—Ç—É–ø–Ω—ã**
- –õ–∏–º–∏—Ç: **999 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å**
- –ú–∞–∫—Å–∏–º—É–º: 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ

---

## üìã –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /ask –∏–ª–∏ /search
2. –°—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë–µ–∑ –∫–æ–º–∞–Ω–¥—ã

```
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ë–æ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –ø–æ–∫–∞–∂–µ—Ç –∫–Ω–æ–ø–∫–∏
3. –ù–∞–∂–º–∏—Ç–µ /ask –∏–ª–∏ /search
4. –ë–æ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ (–µ—Å–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã)

```
/ask –ß—Ç–æ –ø–∏—Å–∞–ª–∏ –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏?
/search –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã
```

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç –≥–æ–ª–æ—Å–æ–≤—ã—Ö

- **–§–æ—Ä–º–∞—Ç:** OGG/Opus (—Å—Ç–∞–Ω–¥–∞—Ä—Ç Telegram)
- **Sample Rate:** 48000 Hz
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 60 —Å–µ–∫—É–Ω–¥
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** ~1 –ú–ë (60 —Å–µ–∫—É–Ω–¥)

### SaluteSpeech API Flow

```
1. Upload Audio
   POST /data:upload
   ‚Üí request_file_id

2. Start Recognition
   POST /speech:async_recognize
   Body: {options, request_file_id}
   ‚Üí task_id

3. Poll Status (–∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
   GET /task:get?id={task_id}
   ‚Üí status: NEW ‚Üí PROCESSING ‚Üí DONE

4. Download Result
   GET /data:download?response_file_id={response_file_id}
   ‚Üí transcription text
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# Redis cache (24 —á–∞—Å–∞ TTL)
Key: voice_transcription:{md5_hash}
Value: "—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç"
TTL: 86400 —Å–µ–∫—É–Ω–¥ (24 —á–∞—Å–∞)

# –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ ‚Üí instant response –∏–∑ –∫–µ—à–∞
```

### OAuth2 Token

```python
# Access token –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
Token lifetime: 30 –º–∏–Ω—É—Ç
Refresh: –∑–∞ 1 –º–∏–Ω—É—Ç—É –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
Cache: –≤ –ø–∞–º—è—Ç–∏ VoiceTranscriptionService
```

---

## üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
‚ùå –ì–æ–ª–æ—Å–æ–≤–æ–µ 61 —Å–µ–∫—É–Ω–¥–∞
‚Üí "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 —Å–µ–∫—É–Ω–¥"

‚úÖ –ì–æ–ª–æ—Å–æ–≤–æ–µ 30 —Å–µ–∫—É–Ω–¥
‚Üí –£—Å–ø–µ—à–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è
```

### 2. –ü–æ–¥–ø–∏—Å–∫–∞

```
‚ùå Free tier –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚Üí "–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è Premium"

‚úÖ Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚Üí –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
```

### 3. –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç

```
Premium: 50 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å

‚ùå 51-–π –∑–∞–ø—Ä–æ—Å
‚Üí "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç: 50"

‚úÖ –ù–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å—á–µ—Ç—á–∏–∫ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
```

### 4. –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∏

**–î–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è:**
- ‚úÖ –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ
- ‚úÖ –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ –≤ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –ò–∑–±–µ–≥–∞–π—Ç–µ —Ñ–æ–Ω–æ–≤–æ–≥–æ —à—É–º–∞
- ‚úÖ –î–µ—Ä–∂–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω –±–ª–∏–∑–∫–æ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –®—É–º–Ω–∞—è –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Üí –ø–ª–æ—Ö–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
- ‚ùå –ë—ã—Å—Ç—Ä–∞—è —Ä–µ—á—å ‚Üí –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
- ‚ùå –ê–∫—Ü–µ–Ω—Ç ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

---

## üêõ Troubleshooting

### "–°–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

**–ü—Ä–∏—á–∏–Ω—ã:**
- SaluteSpeech API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ù–µ–≤–µ—Ä–Ω—ã–µ credentials
- –ò—Å—Ç–µ–∫ OAuth2 token

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ credentials –≤ .env
grep SALUTESPEECH telethon/.env

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker logs telethon | grep -i "salutespeech\|voice"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
curl https://smartspeech.sber.ru/rest/v1/

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker restart telethon
```

### "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∏
- –§–æ–Ω–æ–≤—ã–π —à—É–º
- –°–ª–∏—à–∫–æ–º —Ç–∏—Ö–æ
- –ù–µ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∑–∞–ø–∏—à–∏—Ç–µ –≤ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ
- –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç—á–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É

### "Timeout —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏"

**–ü—Ä–∏—á–∏–Ω—ã:**
- SaluteSpeech API –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
- –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ .env
VOICE_MAX_DURATION_SEC=120  # –ë—ã–ª–æ 60

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker restart telethon
```

### "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è (—Å—á–µ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∏—Ç—Å—è –≤ 00:00 UTC)
- –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–æ Enterprise (999 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å)

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: Quick Question

```
User: /ask
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ 5s: "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?"]

Bot: üé§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é... (5s)
Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ AI?"
     üîç –í—ã–ø–æ–ª–Ω—è—é /ask...
Bot: üí° –û—Ç–≤–µ—Ç: –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –≤—ã—à–ª–∞ –Ω–æ–≤–∞—è –º–æ–¥–µ–ª—å...
```

### –ü—Ä–∏–º–µ—Ä 2: Complex Query

```
User: /search
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ 30s: "–Ø —Ö–æ—á—É –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏"]

Bot: üé§ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é... (30s)
Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–Ø —Ö–æ—á—É –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–æ –∫–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏"
     üîç –í—ã–ø–æ–ª–Ω—è—é /search...
Bot: üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
     üì± –í–∞—à–∏ –ø–æ—Å—Ç—ã (5)
     üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç (10)
```

### –ü—Ä–∏–º–µ—Ä 3: Choose Command

```
User: [–≥–æ–ª–æ—Å–æ–≤–æ–µ –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã: "–ë–ª–æ–∫—á–µ–π–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"]

Bot: ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "–ë–ª–æ–∫—á–µ–π–Ω —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"
     ü§î –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
     [üí° /ask] [üîç /search]

User: [–Ω–∞–∂–∏–º–∞–µ—Ç /ask]
Bot: üîç –í—ã–ø–æ–ª–Ω—è—é /ask...
Bot: üí° –û—Ç–≤–µ—Ç: –ë–ª–æ–∫—á–µ–π–Ω - —ç—Ç–æ...
```

---

## ‚ö° Best Practices

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã**
   - `/ask` ‚Üí [–≥–æ–ª–æ—Å–æ–≤–æ–µ]
   - –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–π–º–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å

2. **–ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ**
   - –õ—É—á—à–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
   - –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫

3. **–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ –≤ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ**
   - –ë–µ–∑ —Ñ–æ–Ω–æ–≤–æ–≥–æ —à—É–º–∞
   - –ß–µ—Ç–∫–∏–π –∑–≤—É–∫

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã**
   - 10-30 —Å–µ–∫—É–Ω–¥ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
   - –ë—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞

5. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é**
   - –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç —á—Ç–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª
   - –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–µ—Ä–µ–∑–∞–ø–∏—à–∏—Ç–µ

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**
   - –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ ‚Üí instant
   - –≠–∫–æ–Ω–æ–º–∏—è API calls
   - TTL 24 —á–∞—Å–∞

2. **Graceful degradation**
   - –ï—Å–ª–∏ SaluteSpeech –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
   - –ï—Å–ª–∏ timeout ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

3. **Subscription checks**
   - Premium/Enterprise only
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

4. **Async everywhere**
   - `async def transcribe()`
   - `await client.post()`
   - Non-blocking polling

---

## üìù Configuration

### Environment Variables

```bash
# SaluteSpeech API
SALUTESPEECH_CLIENT_ID=your_client_id
SALUTESPEECH_CLIENT_SECRET=your_secret
SALUTESPEECH_SCOPE=SALUTE_SPEECH_PERS
SALUTESPEECH_URL=https://smartspeech.sber.ru/rest/v1

# Voice settings
VOICE_TRANSCRIPTION_ENABLED=true
VOICE_MAX_DURATION_SEC=60
VOICE_CACHE_TTL=86400  # 24h
```

### Subscription Tiers

```python
# subscription_config.py

"premium": {
    "voice_transcription_enabled": True,
    "voice_queries_per_day": 50
}

"enterprise": {
    "voice_transcription_enabled": True,
    "voice_queries_per_day": 999
}
```

### Database Migration

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
python telethon/scripts/migrations/add_voice_transcription_support.py

# –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è:
# - users.voice_queries_today
# - users.voice_queries_reset_at
```

---

## ‚úÖ Verification

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ credentials

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ credentials —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
docker exec telethon printenv | grep SALUTESPEECH

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# SALUTESPEECH_CLIENT_ID=...
# SALUTESPEECH_CLIENT_SECRET=...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

```bash
# –¢–µ—Å—Ç OAuth2 token
curl -X POST https://ngw.devices.sberbank.ru:9443/api/v2/oauth \
  -H "Authorization: Basic BASE64_CREDENTIALS" \
  -d "scope=SALUTE_SPEECH_PERS"

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å access_token
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis cache

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–µ—à —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π
docker exec redis redis-cli KEYS "voice_transcription:*"

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ

```
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ /ask
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ 10s: "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RAG –æ—Ç–≤–µ—Ç
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Credentials Storage

```bash
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –≤ .env (–Ω–µ –≤ –∫–æ–¥–µ!)
SALUTESPEECH_CLIENT_SECRET=d944b976-...

# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
client_secret = "d944b976-..."  # NO! Hardcoded!
```

### OAuth2 Token Refresh

```python
# ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
if token_expires_at < now:
    token = await get_access_token()

# Token cache –≤ –ø–∞–º—è—Ç–∏ (–Ω–µ –≤ Redis!)
# –ü—Ä–∏—á–∏–Ω–∞: –∫–æ—Ä–æ—Ç–∫–∏–π TTL (30 –º–∏–Ω), –≤—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

### Audio Data

```python
# ‚úÖ –ì–æ–ª–æ—Å–æ–≤—ã–µ –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
# –¢–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ Redis

# ‚ùå –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã
# –ü—Ä–∏—á–∏–Ω–∞: –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å, —Ä–∞–∑–º–µ—Ä, GDPR
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### SaluteSpeech API

**–¶–µ–Ω—ã (–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ):**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –≤ [Studio](https://developers.sber.ru/studio)
- –û–±—ã—á–Ω–æ: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Google Speech-to-Text

**–û—Ü–µ–Ω–∫–∞ (–ø—Ä–∏–º–µ—Ä–Ω–∞—è):**
- 1 –º–∏–Ω—É—Ç–∞ –∞—É–¥–∏–æ ‚âà —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ~100 —Ç–æ–∫–µ–Ω–æ–≤ GigaChat
- 100 –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø–æ 30s/–¥–µ–Ω—å ‚âà 50 –º–∏–Ω—É—Ç/–¥–µ–Ω—å

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

**–ï—Å–ª–∏ SaluteSpeech –¥–æ—Ä–æ–≥–æ:**

1. **OpenAI Whisper API**
   - $0.006 –∑–∞ –º–∏–Ω—É—Ç—É
   - 100 –≥–æ–ª–æ—Å–æ–≤—ã—Ö –ø–æ 30s = $3/–º–µ—Å—è—Ü

2. **Whisper Local** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
   - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (30-60s –Ω–∞ CPU)
   - –ù—É–∂–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## üìö –°—Å—ã–ª–∫–∏

**SaluteSpeech:**
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://developers.sber.ru/docs/ru/salutespeech/overview)
- [API Reference](https://developers.sber.ru/docs/ru/salutespeech/api)
- [Studio (credentials)](https://developers.sber.ru/studio)
- [Postman Collection](https://www.postman.com/salute-developers-7605/public/documentation/luv5vaf/salutespeech-api)

**–ö–æ–¥:**
- `telethon/voice_transcription_service.py` - SaluteSpeech –∫–ª–∏–µ–Ω—Ç
- `telethon/bot.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤—ã—Ö
- `telethon/subscription_config.py` - –õ–∏–º–∏—Ç—ã
- `telethon/models.py` - Voice statistics

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
- `telethon/scripts/migrations/add_voice_transcription_support.py`

---

## üÜò Support

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub
- –û–ø–∏—à–∏—Ç–µ –æ—à–∏–±–∫—É –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–æ–≥–∏

**–õ–æ–≥–∏:**
```bash
# –õ–æ–≥–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏
docker logs telethon | grep -i "voice\|salutespeech"

# –õ–æ–≥–∏ Redis cache
docker exec redis redis-cli KEYS "voice_*"
```

---

**Version:** 3.3.0  
**Last Updated:** 13 –æ–∫—Ç—è–±—Ä—è 2025  
**Maintainer:** Telegram Bot Team

