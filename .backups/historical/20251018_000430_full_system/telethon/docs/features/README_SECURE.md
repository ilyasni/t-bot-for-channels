# üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Telegram –ø–∞—Ä—Å–µ—Ä–∞

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

–°–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## ‚ö†Ô∏è –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

- ‚ùå **–í–≤–æ–¥ –∫–æ–¥–æ–≤ –≤ Telegram —á–∞—Ç** ‚Üí ‚úÖ **HTTPS –≤–µ–±-—Ñ–æ—Ä–º–∞**
- ‚ùå **–û—Ç–∫—Ä—ã—Ç–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ API –¥–∞–Ω–Ω—ã—Ö** ‚Üí ‚úÖ **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ Fernet**
- ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞** ‚Üí ‚úÖ **Rate limiting + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**
- ‚ùå **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–µ—Å—Å–∏–∏** ‚Üí ‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å TTL**

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
```bash
# –í–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞ —Ö–æ—Å—Ç–µ)
python generate_encryption_key.py
```
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á –≤ `.env` —Ñ–∞–π–ª:
```bash
ENCRYPTION_KEY=your_generated_key_here
```

> **üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `pip install -r requirements.txt` –∑–∞–ø—É—Å–∫–∞—Ç—å –ù–ï –ù–£–ñ–ù–û - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker –æ–±—Ä–∞–∑–∞!

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
BOT_TOKEN=your_bot_token_from_botfather
ENCRYPTION_KEY=your_generated_key_here
AUTH_BASE_URL=https://telegram-auth.produman.studio

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (SSL)
SSL_CERT_PATH=/path/to/certificate.crt
SSL_KEY_PATH=/path/to/private.key

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ docker-compose)
DATABASE_URL=postgresql://postgres:your_password@postgres:5432/postgres?sslmode=require
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–í–ê–ñ–ù–û!)
```bash
# –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
docker compose -p localai -f docker-compose.override.yml exec telethon python migrate_database.py
```

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã n8n-installer (–≤–∫–ª—é—á–∞—è telethon)
docker compose -p localai -f docker-compose.override.yml up --build -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose -p localai -f docker-compose.override.yml ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ telethon
docker compose -p localai -f docker-compose.override.yml logs telethon

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
docker compose -p localai -f docker-compose.override.yml logs telethon-auth
```

### 5. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º
```bash
# Telegram –±–æ—Ç - —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
# –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
# https://telegram-auth.produman.studio

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
curl https://telegram-auth.produman.studio/health
```

### 6. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose -p localai -f docker-compose.override.yml down

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ telethon
docker compose -p localai -f docker-compose.override.yml restart telethon

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker compose -p localai -f docker-compose.override.yml up --build -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose -p localai -f docker-compose.override.yml logs -f telethon
```

## üîê –ü—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ù–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
1. **–í –±–æ—Ç–µ:** `/auth` - –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ–±-—Ñ–æ—Ä–º—É
2. **–í –±—Ä–∞—É–∑–µ—Ä–µ:** –û—Ç–∫—Ä—ã—Ç—å HTTPS —Å—Å—ã–ª–∫—É, –≤–≤–µ—Å—Ç–∏ API –¥–∞–Ω–Ω—ã–µ
3. **–í Telegram:** –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥, –≤–≤–µ—Å—Ç–∏ –≤ –≤–µ–±-—Ñ–æ—Ä–º–µ
4. **–ì–æ—Ç–æ–≤–æ:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

### –°—Ç–∞—Ä—ã–π –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–£–î–ê–õ–ï–ù):
‚ùå ~~–í–≤–æ–¥ API –¥–∞–Ω–Ω—ã—Ö –≤ —á–∞—Ç~~  
‚ùå ~~–í–≤–æ–¥ –∫–æ–¥–æ–≤ –≤ —á–∞—Ç~~  
‚ùå ~~–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ~~

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
- üîê **API Hash** –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –≤ –ë–î
- üîê **–ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤** –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ –ë–î
- üîê **–ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è** –≤ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫:
- üö´ **Rate limiting:** 3 –ø–æ–ø—ã—Ç–∫–∏ –≤ 5 –º–∏–Ω—É—Ç
- üö´ **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** 1 —á–∞—Å –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
- üö´ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏:** TTL 10 –º–∏–Ω—É—Ç
- üö´ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π

### HTTPS –∑–∞—â–∏—Ç–∞:
- üîí **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- üîí **HTTPS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
- üîí **–ó–∞—â–∏—â–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞** –∫–æ–¥–æ–≤

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `/auth` - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –≤–µ–±-—Ñ–æ—Ä–º—É
- `/auth_status` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `/clear_auth` - –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `/add_channel` - –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `/my_channels` - –ü–æ–∫–∞–∑–∞—Ç—å –≤–∞—à–∏ –∫–∞–Ω–∞–ª—ã
- `/help` - –°–ø—Ä–∞–≤–∫–∞

### ‚ùå –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `/auth_code` - **–û–¢–ö–õ–Æ–ß–ï–ù–ê** –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
–í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∑ SSL).

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º
3. –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –≤ .env (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞):
```bash
SSL_CERT_PATH=./certs/certificate.crt
SSL_KEY_PATH=./certs/private.key
```
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
```bash
docker compose -p localai -f docker-compose.override.yml up --build -d
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
```
n8n-installer/
‚îú‚îÄ‚îÄ certs/
‚îÇ   ‚îú‚îÄ‚îÄ certificate.crt
‚îÇ   ‚îî‚îÄ‚îÄ private.key
‚îú‚îÄ‚îÄ docker-compose.override.yml
‚îî‚îÄ‚îÄ telethon/
    ‚îî‚îÄ‚îÄ .env
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
curl https://telegram-auth.produman.studio/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose -p localai -f docker-compose.override.yml ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ telethon
docker compose -p localai -f docker-compose.override.yml logs telethon --tail=50

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose -p localai -f docker-compose.override.yml logs -f telethon
```

### –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ rate limiting –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- –û—à–∏–±–∫–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ stdout –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º telethon
docker stats $(docker compose -p localai -f docker-compose.override.yml ps -q telethon)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞
docker compose -p localai -f docker-compose.override.yml exec telethon df -h
```

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
telethon/
‚îú‚îÄ‚îÄ üîê –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
‚îÇ   ‚îú‚îÄ‚îÄ secure_auth_manager.py      # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ crypto_utils.py             # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ auth_web_server.py          # HTTPS –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ start_auth_server.py        # –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ ü§ñ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–æ—Ç:
‚îÇ   ‚îú‚îÄ‚îÄ bot.py                      # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–æ—Ç (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)
‚îÇ   ‚îú‚îÄ‚îÄ bot_standalone.py           # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ auth.py                     # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:
‚îÇ   ‚îú‚îÄ‚îÄ models.py                   # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ database.py                 # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:
‚îÇ   ‚îú‚îÄ‚îÄ start_secure_system.py      # –ó–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ generate_encryption_key.py  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
‚îÇ   ‚îú‚îÄ‚îÄ SECURITY_UPDATE.md          # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ README_SECURE.md            # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
    ‚îú‚îÄ‚îÄ requirements.txt            # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    ‚îî‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker compose -p localai -f docker-compose.override.yml exec telethon python migrate_database.py
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è:
1. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `users`
2. ‚úÖ –®–∏—Ñ—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API hash –∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:
```python
from database import SessionLocal
from models import User
from crypto_utils import crypto_manager

db = SessionLocal()
users = db.query(User).filter(User.api_hash.isnot(None)).all()

for user in users:
    if user.api_hash:
        print(f"User {user.telegram_id}: API hash encrypted: {isinstance(user.api_hash, bytes)}")
        print(f"Masked phone: {user.get_masked_phone_number()}")
        print(f"Masked API hash: {user.get_masked_api_hash()}")

db.close()
```

## ‚ùì FAQ

### Q: –ü–æ—á–µ–º—É –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /auth_code?
**A:** –í–≤–æ–¥ –∫–æ–¥–æ–≤ –≤ Telegram —á–∞—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–µ–Ω. –ö–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω—ã –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ª–æ–≥–∞—Ö.

### Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞?
**A:** –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é HTTPS —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞—â–∏—â–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ.

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏?
**A:** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—à–∏—Ñ—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTP?
**A:** –¢–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ HTTPS.

### Q: –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç?
**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt, Cloudflare, –∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä SSL.

### Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è—é –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è?
**A:** –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ.

### Q: –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
**A:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
```bash
docker compose -p localai -f docker-compose.override.yml up --build -d
```

### Q: –ö–∞–∫ –≤–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä telethon –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏?
**A:** 
```bash
docker compose -p localai -f docker-compose.override.yml exec telethon bash
```

### Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
**A:**
```bash
docker compose -p localai -f docker-compose.override.yml exec telethon env | grep -E "(BOT_TOKEN|ENCRYPTION_KEY|DATABASE_URL)"
```

### Q: –ö–∞–∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ telethon –±–µ–∑ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤?
**A:**
```bash
docker compose -p localai -f docker-compose.override.yml restart telethon
```

### Q: –ù—É–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å pip install –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
**A:** –ù–ï–¢! –í Docker –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞. –ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
docker compose -p localai -f docker-compose.override.yml up --build -d
```

### Q: –ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ?
**A:** –û–±–Ω–æ–≤–∏—Ç–µ requirements.txt –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑:
```bash
docker compose -p localai -f docker-compose.override.yml up --build -d
```

### Q: –ü–æ–ª—É—á–∞—é –æ—à–∏–±–∫—É "column users.auth_session_id does not exist"
**A:** –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
docker compose -p localai -f docker-compose.override.yml exec telethon python migrate_database.py
```

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å?
**A:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä telethon –∑–∞–ø—É—â–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ–≤—Ç–æ—Ä–Ω–æ

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
2. **–£–±–µ–¥–∏—Ç–µ—Å—å** –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ .env
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL** —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
4. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å** –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
python generate_encryption_key.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
curl https://telegram-auth.produman.studio/health

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
docker compose -p localai -f docker-compose.override.yml ps
docker compose -p localai -f docker-compose.override.yml logs -f telethon
docker compose -p localai -f docker-compose.override.yml restart telethon

# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä telethon –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker compose -p localai -f docker-compose.override.yml exec telethon bash

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker compose -p localai -f docker-compose.override.yml exec telethon env | grep -E "(BOT_TOKEN|ENCRYPTION_KEY|DATABASE_URL)"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
docker compose -p localai -f docker-compose.override.yml up --build -d
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- HTTPS –∑–∞—â–∏—â–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞
- Rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π

### ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ:
- –ö—Ä–∞—Å–∏–≤—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Graceful shutdown

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

---

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏!

**üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ!**
