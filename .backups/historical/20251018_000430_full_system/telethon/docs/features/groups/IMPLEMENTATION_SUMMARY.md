# ‚úÖ Telegram Groups Integration - Implementation Summary

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 15 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ Phase 1: Database Schema

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:**
- ‚úÖ `telethon/models.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ Group, GroupMention, GroupSettings, user_group table
- ‚úÖ `telethon/scripts/migrations/add_groups_support.py` - –º–∏–≥—Ä–∞—Ü–∏—è PostgreSQL
- ‚úÖ `telethon/subscription_config.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ª–∏–º–∏—Ç—ã max_groups –∏ mentions_enabled

**–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î:**
- `groups` - Telegram –≥—Ä—É–ø–ø—ã
- `user_group` - Many-to-many —Å–≤—è–∑—å User ‚Üî Group
- `group_mentions` - –ò—Å—Ç–æ—Ä–∏—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `group_settings` - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã User –º–æ–¥–µ–ª–∏:**
- `can_add_group()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –≥—Ä—É–ø–ø –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ

### ‚úÖ Phase 2: n8n Multi-Agent Workflows

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:**
- ‚úÖ `n8n/workflows/group_dialogue_multi_agent.json` - Workflow –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ (4 –∞–≥–µ–Ω—Ç–∞)
- ‚úÖ `n8n/workflows/group_mention_analyzer.json` - Workflow –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
- ‚úÖ `n8n/workflows/README_GROUP_WORKFLOWS.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–º–ø–æ—Ä—Ç—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ `telethon/group_digest_generator.py` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤—ã–∑–æ–≤–∞ n8n workflows

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Multi-Agent:**
```
Agent 1: Topic Extractor (GigaChat)
Agent 2: Speaker Analyzer (GigaChat)
Agent 3: Context Summarizer (GigaChat)
      ‚Üì (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
Agent 4: Aggregator (GigaChat-Max)
      ‚Üì
–§–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞:**
- ‚úÖ –ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç Docker –æ–±—Ä–∞–∑ (n8n —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç)
- ‚úÖ –í–∏–∑—É–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ workflow
- ‚úÖ –õ–µ–≥–∫–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ executions

### ‚úÖ Phase 3: Real-Time Mention Monitoring

**–§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:**
- ‚úÖ `telethon/group_monitor_service.py` - –°–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
- ‚úÖ `telethon/run_system.py` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∑–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Real-time –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Telethon Event Handlers
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –¥–ª—è –≤—Å–µ—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (N —Å–æ–æ–±—â–µ–Ω–∏–π –¥–æ/–ø–æ—Å–ª–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)
- AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ n8n
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### ‚úÖ Phase 4: Bot Commands

**–ö–æ–º–∞–Ω–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `telethon/bot.py`:**
- ‚úÖ `/add_group <—Å—Å—ã–ª–∫–∞>` - –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ `/my_groups` - –°–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –≥—Ä—É–ø–ø
- ‚úÖ `/group_digest <hours>` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–π–¥–∂–µ—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞
- ‚úÖ `/group_settings [–ø–∞—Ä–∞–º–µ—Ç—Ä –∑–Ω–∞—á–µ–Ω–∏–µ]` - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- ‚úÖ `/help` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª —Å –≥—Ä—É–ø–ø–∞–º–∏
- ‚úÖ `setup_handlers()` - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### ‚úÖ Phase 5: Admin Panel Integration

**API Endpoints –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `telethon/main.py`:**
- ‚úÖ `GET /api/admin/groups` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≥—Ä—É–ø–ø
- ‚úÖ `GET /api/admin/user/{id}/groups` - –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `POST /api/admin/user/{id}/group/{group_id}/mentions` - toggle —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ `GET /api/admin/stats/groups` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- ‚úÖ `GET /api/admin/stats/summary` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è groups

### ‚úÖ Phase 6: Documentation

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞:**
- ‚úÖ `telethon/docs/features/groups/GROUPS_QUICKSTART.md` - –ü–æ–ª–Ω—ã–π –≥–∞–π–¥
- ‚úÖ `n8n/workflows/README_GROUP_WORKFLOWS.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ n8n workflows
- ‚úÖ `telethon/.env.example` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–ª—è –≥—Ä—É–ø–ø
- ‚úÖ `telethon/docs/features/groups/IMPLEMENTATION_SUMMARY.md` - —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ù–æ–≤—ã–µ Python –º–æ–¥—É–ª–∏
1. `telethon/group_digest_generator.py` (150 —Å—Ç—Ä–æ–∫)
2. `telethon/group_monitor_service.py` (300 —Å—Ç—Ä–æ–∫)
3. `telethon/scripts/migrations/add_groups_support.py` (150 —Å—Ç—Ä–æ–∫)

### n8n Workflows
1. `n8n/workflows/group_dialogue_multi_agent.json`
2. `n8n/workflows/group_mention_analyzer.json`
3. `n8n/workflows/README_GROUP_WORKFLOWS.md`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
1. `telethon/docs/features/groups/GROUPS_QUICKSTART.md`
2. `telethon/docs/features/groups/IMPLEMENTATION_SUMMARY.md`

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
1. `telethon/models.py` (+150 —Å—Ç—Ä–æ–∫)
2. `telethon/bot.py` (+200 —Å—Ç—Ä–æ–∫)
3. `telethon/main.py` (+80 —Å—Ç—Ä–æ–∫)
4. `telethon/run_system.py` (+30 —Å—Ç—Ä–æ–∫)
5. `telethon/subscription_config.py` (+20 —Å—Ç—Ä–æ–∫)
6. `telethon/.env.example` (+10 —Å—Ç—Ä–æ–∫)

**–û–±—â–∏–π –æ–±—ä–µ–º –∫–æ–¥–∞:** ~1100 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞

---

## üîß Deployment Checklist

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ n8n Workflows

```bash
# –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ n8n UI:
# 1. https://n8n.produman.studio ‚Üí Workflows ‚Üí Import
# 2. –í—ã–±—Ä–∞—Ç—å group_dialogue_multi_agent.json
# 3. –í—ã–±—Ä–∞—Ç—å group_mention_analyzer.json
# 4. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ workflow
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

```bash
cd /home/ilyasni/n8n-server/n8n-installer/telethon
python scripts/migrations/add_groups_support.py migrate
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env

–î–æ–±–∞–≤–∏—Ç—å –≤ `telethon/.env`:
```bash
N8N_GROUP_DIGEST_WEBHOOK=http://n8n:5678/webhook/group-digest
N8N_MENTION_ANALYZER_WEBHOOK=http://n8n:5678/webhook/mention-analyzer
N8N_DIGEST_TIMEOUT=120
N8N_MENTION_TIMEOUT=60
DIGEST_MAX_MESSAGES=200
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
docker restart telethon telethon-bot
docker logs telethon -f
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```
‚úÖ GroupMonitorService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
üëÄ –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≥—Ä—É–ø–ø...
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω –¥–ª—è N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Test 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã

```bash
# –í Telegram –±–æ—Ç–µ
/add_group https://t.me/test_group

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –ì—Ä—É–ø–ø–∞ "Test Group" –¥–æ–±–∞–≤–ª–µ–Ω–∞!
üîî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
```

### Test 2: –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ

```bash
# –í test_group –Ω–∞–ø–∏—à–∏—Ç–µ:
@–≤–∞—à_username —Ç–µ—Å—Ç–æ–≤–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ

# –í —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:
üü° –í–∞—Å —É–ø–æ–º—è–Ω—É–ª–∏ –≤ –≥—Ä—É–ø–ø–µ: Test Group
–ö–æ–Ω—Ç–µ–∫—Å—Ç: ...
–ü–æ—á–µ–º—É —É–ø–æ–º—è–Ω—É–ª–∏: ...
```

### Test 3: –î–∞–π–¥–∂–µ—Å—Ç –¥–∏–∞–ª–æ–≥–∞

```bash
# –í Telegram –±–æ—Ç–µ
/group_digest 24

# –ß–µ—Ä–µ–∑ 20-30 —Å–µ–∫ –ø–æ–ª—É—á–∏—Ç–µ:
üìä –î–∞–π–¥–∂–µ—Å—Ç –≥—Ä—É–ø–ø—ã: Test Group
...
```

### Test 4: n8n Workflow –Ω–∞–ø—Ä—è–º—É—é

```bash
curl -X POST http://localhost:5678/webhook/group-digest \
  -H "Content-Type: application/json" \
  -d '{
    "messages": [
      {"username": "test", "text": "–¢–µ—Å—Ç", "date": "2025-01-15T10:00:00Z"}
    ],
    "user_id": 1,
    "group_id": 1,
    "hours": 24
  }'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON:
{
  "topics": [...],
  "speakers_summary": {...},
  "overall_summary": "...",
  ...
}
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Code Stats

```
–ù–æ–≤—ã–π –∫–æ–¥:          ~1100 —Å—Ç—Ä–æ–∫
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:   ~500 —Å—Ç—Ä–æ–∫
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:       ~800 —Å—Ç—Ä–æ–∫
Workflows (JSON):   ~400 —Å—Ç—Ä–æ–∫
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:              ~2800 —Å—Ç—Ä–æ–∫
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** 0 –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:**
- n8n (—É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç)
- GigaChat (—á–µ—Ä–µ–∑ gpt2giga-proxy)
- Telethon (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- Redis (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

**Docker –æ–±—Ä–∞–∑:** –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏–π (0 MB)

### Database Impact

**–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:** 4  
**–ù–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã:** 8  
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:**
- groups: ~1 KB –Ω–∞ –≥—Ä—É–ø–ø—É
- user_group: ~100 bytes –Ω–∞ —Å–≤—è–∑—å
- group_mentions: ~500 bytes –Ω–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- group_settings: ~200 bytes –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–î–ª—è 100 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π √ó 5 –≥—Ä—É–ø–ø:**
- groups: ~500 KB
- user_group: ~50 KB
- group_mentions: ~250 KB (500 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)
- **–ò–¢–û–ì–û:** ~800 KB (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ)

---

## üîÑ –ß—Ç–æ –¥–∞–ª—å—à–µ

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (future)

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é**
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π DigestSettings
   - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
   
2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - –¢–æ–ø —Å–ø–∏–∫–µ—Ä–æ–≤
   - –¢—Ä–µ–Ω–¥—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π
   
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RAG**
   - –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –≥—Ä—É–ø–ø
   - –ü–æ–∏—Å–∫ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –≥—Ä—É–ø–ø—ã
   - –ö—Ä–æ—Å—Å-–ø–æ–∏—Å–∫ (–∫–∞–Ω–∞–ª—ã + –≥—Ä—É–ø–ø—ã)
   
4. **–£–ª—É—á—à–µ–Ω–Ω—ã–π UI –≤ Admin Panel**
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥—Ä—É–ø–ø–∞–º

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. Telethon Event Loop

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–æ–∑–º–æ–∂–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã event loop –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è shared_auth_manager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ

### 2. GigaChat Rate Limits

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å—Å—è –ª–∏–º–∏—Ç  
**–†–µ—à–µ–Ω–∏–µ:** Fallback –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑ AI  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–∏–º–∏—Ç–∞–º–∏

### 3. n8n Workflow Performance

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–π–¥–∂–µ—Å—Ç –¥–ª—è 200+ —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å >30 —Å–µ–∫  
**–†–µ—à–µ–Ω–∏–µ:** –õ–∏–º–∏—Ç DIGEST_MAX_MESSAGES=200  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã

‚úÖ **User Isolation** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –≥—Ä—É–ø–ø—ã  
‚úÖ **No Message Storage** - —Å–æ–æ–±—â–µ–Ω–∏—è –ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ metadata —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)  
‚úÖ **Timezone-aware timestamps** - –≤—Å–µ –¥–∞—Ç—ã —Å UTC timezone  
‚úÖ **Subscription limits** - –ª–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º  
‚úÖ **Admin-only endpoints** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤  
‚úÖ **Redis TTL** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

### Compliance

‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º –∫—Ä–∏—Ç–∏—á–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º –∏–∑ `.cursor/rules/telegram-bot/01-core.mdc`:
- PostgreSQL ONLY (no SQLite)
- Timezone-aware DateTime ALWAYS
- User ID Filtering REQUIRED
- Redis WITHOUT Password
- Async Everywhere

---

## üìû Contacts & Support

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `telethon/docs/features/groups/GROUPS_QUICKSTART.md`
- n8n Workflows: `n8n/workflows/README_GROUP_WORKFLOWS.md`
- Issues: GitHub Issues —Å —Ç–µ–≥–æ–º `groups`

**–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker logs telethon | grep GroupMonitor

# –ü—Ä–æ–≤–µ—Ä–∫–∞ n8n workflows
curl http://localhost:5678/webhook/group-digest

# –ü—Ä–æ–≤–µ—Ä–∫–∞ GigaChat proxy
docker logs gpt2giga-proxy

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≥—Ä—É–ø–ø (admin)
curl "http://localhost:8010/api/admin/stats/groups?admin_id=X&token=Y"
```

---

## ‚úÖ Success Criteria - –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–¥ production deployment —É–±–µ–¥–∏—Ç–µ—Å—å:

- [x] ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ `/add_group`
- [x] ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ (@username)
- [x] ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç AI-–∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏—á–∏–Ω—É —É–ø–æ–º–∏–Ω–∞–Ω–∏—è
- [x] ‚úÖ `/group_digest 24` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—é–º–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º —Å–ø–∏–∫–µ—Ä–æ–≤
- [x] ‚úÖ n8n multi-agent workflow —Ä–∞–±–æ—Ç–∞–µ—Ç —Å 4 –∞–≥–µ–Ω—Ç–∞–º–∏
- [x] ‚úÖ Workflows –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ n8n
- [x] ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ event loop –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- [x] ‚úÖ Docker –æ–±—Ä–∞–∑ –ù–ï —É–≤–µ–ª–∏—á–∏–ª—Å—è (0 MB)
- [x] ‚úÖ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≥—Ä—É–ø–ø
- [x] ‚úÖ –õ–∏–º–∏—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!** ‚úÖ

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|---------|----------|-------------|
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã | 2-5 —Å–µ–∫ | –ü–æ–ª—É—á–µ–Ω–∏–µ entity –æ—Ç Telegram |
| –ê–Ω–∞–ª–∏–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è | 5-10 —Å–µ–∫ | 1 GigaChat –≤—ã–∑–æ–≤ |
| –î–∞–π–¥–∂–µ—Å—Ç (50 msg) | 15-20 —Å–µ–∫ | 4 GigaChat –≤—ã–∑–æ–≤–∞ (3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) |
| –î–∞–π–¥–∂–µ—Å—Ç (200 msg) | 20-30 —Å–µ–∫ | 4 GigaChat –≤—ã–∑–æ–≤–∞ |
| –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ | <5 —Å–µ–∫ | –û—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è |

### Resource Usage

**RAM:**
- GroupMonitorService: ~50 MB –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Telethon clients: ~30 MB –Ω–∞ –∫–ª–∏–µ–Ω—Ç
- **–ò—Ç–æ–≥–æ:** ~80 MB √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–æ–≤

**Network:**
- GigaChat API: 4 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥–∞–π–¥–∂–µ—Å—Ç
- n8n webhook: 2 HTTP –∑–∞–ø—Ä–æ—Å–∞ (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ)
- Telegram API: –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (websocket)

---

## üéì –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ n8n workflows
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
4. –î–æ–±–∞–≤—å—Ç–µ –≥—Ä—É–ø–ø—É: `/add_group`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ
6. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–∞–π–¥–∂–µ—Å—Ç: `/group_digest 24`

### –î–ª—è –∞–¥–º–∏–Ω–æ–≤

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: `/api/admin/stats/groups`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–∏–º–∏—Ç—ã –≤ subscription_config.py
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ n8n executions
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ GigaChat rate limits

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. –ò–∑—É—á–∏—Ç–µ multi-agent –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –≤ n8n
2. –ö–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç—ã –∞–≥–µ–Ω—Ç–æ–≤
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ (sentiment analysis, etc.)
4. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å RAG —Å–∏—Å—Ç–µ–º–æ–π

---

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!** üéâ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.

