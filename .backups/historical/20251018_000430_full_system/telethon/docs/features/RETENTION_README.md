# –°–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å—Ç—ã, –≤—ã—Ö–æ–¥—è—â–∏–µ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ç 1 –¥–æ 365 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ—Å—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- ‚úÖ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ —á–µ—Ä–µ–∑ API
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQLite –∏ PostgreSQL

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **–æ—Ç –¥–∞—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞** –≤ –∫–∞–∂–¥–æ–º –∫–∞–Ω–∞–ª–µ:

```
–î–∞—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏—è = –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞ - retention_days
–£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –ø–æ—Å—Ç—ã: posted_at < –¥–∞—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏—è
```

**–ü—Ä–∏–º–µ—Ä:**
- –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ: 2025-10-10
- retention_days = 30
- –î–∞—Ç–∞ –æ—Ç—Å–µ—á–µ–Ω–∏—è: 2025-09-10
- –£–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –ø–æ—Å—Ç—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –¥–æ 2025-09-10

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `retention_days`:

```bash
python add_retention_days.py
```

–ú–∏–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –î–æ–±–∞–≤–∏—Ç –∫–æ–ª–æ–Ω–∫—É `retention_days` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –¥–Ω–µ–π –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–æ–∑–¥–∞—Å—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã (–¥–ª—è SQLite)

**–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (PostgreSQL):**
```bash
python add_retention_days.py --rollback
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:

```env
# –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_RETENTION_DAYS=30

# –í—Ä–µ–º—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ (—Ñ–æ—Ä–º–∞—Ç HH:MM)
CLEANUP_SCHEDULE_TIME=03:00
```

### 3. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `parser_service.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è:
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤ (–ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)
- –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è)

## API Endpoints

### –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**GET** `/users/{user_id}/retention_settings`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X GET "http://localhost:8010/users/1/retention_settings"
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "user_id": 1,
  "telegram_id": 123456789,
  "retention_days": 30,
  "posts_stats": {
    "total_posts": 1542,
    "oldest_post_date": "2024-09-10T12:00:00+00:00",
    "newest_post_date": "2025-10-10T18:30:00+00:00",
    "channels_count": 5,
    "active_channels_count": 4
  },
  "message": "–ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 –¥–Ω–µ–π –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞"
}
```

### –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**PUT** `/users/{user_id}/retention_settings`

–ò–∑–º–µ–Ω—è–µ—Ç –ø–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `retention_days` (int, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –¥–Ω—è—Ö (1-365)
- `run_cleanup_immediately` (bool, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–∏—Å—Ç–∫—É —Å—Ä–∞–∑—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏):**
```bash
curl -X PUT "http://localhost:8010/users/1/retention_settings" \
  -H "Content-Type: application/json" \
  -d '{
    "retention_days": 60,
    "run_cleanup_immediately": false
  }'
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π):**
```bash
curl -X PUT "http://localhost:8010/users/1/retention_settings" \
  -H "Content-Type: application/json" \
  -d '{
    "retention_days": 15,
    "run_cleanup_immediately": true
  }'
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "user_id": 1,
  "telegram_id": 123456789,
  "old_retention_days": 30,
  "new_retention_days": 60,
  "updated_at": "2025-10-10T15:30:00+00:00",
  "message": "–ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω: 60 –¥–Ω–µ–π | –û—á–∏—Å—Ç–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é"
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π:**
```json
{
  "user_id": 1,
  "telegram_id": 123456789,
  "old_retention_days": 30,
  "new_retention_days": 15,
  "updated_at": "2025-10-10T15:30:00+00:00",
  "cleanup_result": {
    "status": "success",
    "user_id": 1,
    "telegram_id": 123456789,
    "retention_days": 15,
    "posts_deleted": 234,
    "channels_processed": 5
  },
  "message": "–ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω: 15 –¥–Ω–µ–π | –û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: —É–¥–∞–ª–µ–Ω–æ 234 –ø–æ—Å—Ç–æ–≤"
}
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏

**POST** `/cleanup/run`

–ó–∞–ø—É—Å–∫–∞–µ—Ç –æ—á–∏—Å—Ç–∫—É —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ—Å—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST "http://localhost:8010/cleanup/run"
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": "success",
  "users_processed": 12,
  "total_posts_deleted": 3456,
  "user_stats": [
    {
      "user_id": 1,
      "telegram_id": 123456789,
      "retention_days": 30,
      "posts_deleted": 234,
      "channels_processed": 5
    },
    {
      "user_id": 2,
      "telegram_id": 987654321,
      "retention_days": 60,
      "posts_deleted": 89,
      "channels_processed": 3
    }
  ],
  "timestamp": "2025-10-10T15:30:00+00:00"
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–ª–∞—Ç–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã:

### –ü—Ä–∏–º–µ—Ä —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

```python
# –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω
FREE_RETENTION_DAYS = 7  # –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π

# –ë–∞–∑–æ–≤—ã–π –ø–ª–∞–Ω
BASIC_RETENTION_DAYS = 30  # –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

# –ü—Ä–µ–º–∏—É–º –ø–ª–∞–Ω
PREMIUM_RETENTION_DAYS = 90  # –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 90 –¥–Ω–µ–π

# VIP –ø–ª–∞–Ω
VIP_RETENTION_DAYS = 365  # –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥
```

### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞

```python
import httpx

async def upgrade_user_to_premium(user_id: int, plan: str):
    """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    plans = {
        "free": 7,
        "basic": 30,
        "premium": 90,
        "vip": 365
    }
    
    retention_days = plans.get(plan, 30)
    
    async with httpx.AsyncClient() as client:
        response = await client.put(
            f"http://localhost:8010/users/{user_id}/retention_settings",
            json={
                "retention_days": retention_days,
                "run_cleanup_immediately": False  # –ù–µ —É–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ
            }
        )
        return response.json()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
result = await upgrade_user_to_premium(user_id=1, plan="premium")
```

### –ü—Ä–∏–º–µ—Ä –¥–ª—è n8n workflow

```json
{
  "nodes": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [250, 300],
      "webhookId": "subscription-upgrade"
    },
    {
      "name": "Update Retention",
      "type": "n8n-nodes-base.httpRequest",
      "position": [450, 300],
      "parameters": {
        "method": "PUT",
        "url": "=http://localhost:8010/users/{{$json['user_id']}}/retention_settings",
        "jsonParameters": true,
        "bodyParametersJson": "={\n  \"retention_days\": {{$json['plan'] === 'premium' ? 90 : 30}},\n  \"run_cleanup_immediately\": false\n}"
      }
    }
  ]
}
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- **–í—Ä–µ–º—è:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00 (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `CLEANUP_SCHEDULE_TIME`)
- **–ü—Ä–æ—Ü–µ—Å—Å:**
  1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞–µ—Ç –µ–≥–æ `retention_days`
  3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏—Ç –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞
  4. –£–¥–∞–ª—è–µ—Ç –ø–æ—Å—Ç—ã —Å—Ç–∞—Ä—à–µ `(last_post_date - retention_days)`
  5. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:**
```
üßπ –ó–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ—Å—Ç–æ–≤...
  üìä –ö–∞–Ω–∞–ª @techNews: —É–¥–∞–ª–µ–Ω–æ 45 –ø–æ—Å—Ç–æ–≤
  üìä –ö–∞–Ω–∞–ª @cryptoNews: —É–¥–∞–ª–µ–Ω–æ 12 –ø–æ—Å—Ç–æ–≤
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456789: —É–¥–∞–ª–µ–Ω–æ 57 –ø–æ—Å—Ç–æ–≤ –∏–∑ 2 –∫–∞–Ω–∞–ª–æ–≤
‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 12, —É–¥–∞–ª–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: 3456
```

## –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –∑–∞—â–∏—Ç—É:

- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥:** 1 –¥–µ–Ω—å (–Ω–µ–ª—å–∑—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ–Ω—å—à–µ)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥:** 3650 –¥–Ω–µ–π (10 –ª–µ—Ç)
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —É–¥–∞–ª–µ–Ω–∏—è
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /users/{user_id}/retention_settings

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ç–µ–≥–∞–º (–≤–∫–ª—é—á–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤)
GET /posts/tags/stats

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
POST /cleanup/run
```

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∑–æ–Ω—ã

–í —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—ã–ª–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–π–º–∑–æ–Ω–æ–π, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–π `posted_at` –∏ `parsed_at` –æ—Ç—Å—Ç–∞–≤–∞–ª–∏ –Ω–∞ 3 —á–∞—Å–∞.

**–ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –í—Å–µ `datetime.utcnow` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `datetime.now(timezone.utc)`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —è–≤–Ω–∞—è —Ç–∞–π–º–∑–æ–Ω–∞ UTC –¥–ª—è –≤—Å–µ—Ö datetime –æ–±—ä–µ–∫—Ç–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è: `created_at`, `parsed_at`, `posted_at`, `last_parsed_at`

–¢–µ–ø–µ—Ä—å –≤—Å–µ –¥–∞—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ UTC —Å —è–≤–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–æ–π.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏

```bash
# –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ –Ω–∞–ø—Ä—è–º—É—é
python cleanup_service.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
python -c "
from database import SessionLocal
from models import User
db = SessionLocal()
user = db.query(User).first()
print(f'retention_days: {user.retention_days if user else \"–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\"}')
db.close()
"
```

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ retention_days?**
A: –ü—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ –ø–µ—Ä–∏–æ–¥–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ä—ã–µ –ø–æ—Å—Ç—ã –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `run_cleanup_immediately: true` –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã?**
A: –ù–µ—Ç, —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**Q: –í–ª–∏—è–µ—Ç –ª–∏ –æ—á–∏—Å—Ç–∫–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**
A: –û—á–∏—Å—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è (03:00) –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è.

**Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞?**
A: –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–µ–π SQLAlchemy. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**Q: –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏?**
A: –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `CLEANUP_SCHEDULE_TIME` –≤ `.env` —Ñ–∞–π–ª–µ (—Ñ–æ—Ä–º–∞—Ç HH:MM, –Ω–∞–ø—Ä–∏–º–µ—Ä "04:30").

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ (`logs/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.env` —Ñ–∞–π–ª–µ
3. –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–∞–π–º–∑–æ–Ω –≤ –¥–∞–Ω–Ω—ã—Ö

## Changelog

### v1.0.0 (2025-10-10)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –ø–µ—Ä–∏–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- ‚úÖ API endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–π–º–∑–æ–Ω–æ–π (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –Ω–∞ 3 —á–∞—Å–∞)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQLite –∏ PostgreSQL

