# Telegram Channel Parser Bot

Telegram –±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤, RAG-–ø–æ–∏—Å–∫–∞, –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞ –≥—Ä—É–ø–ø.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd /home/ilyasni/n8n-server/n8n-installer/telethon

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Å –≤–∞—à–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å
python bot.py
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **[docs/](docs/)** –ø–∞–ø–∫–µ:

- üé® **[docs/formatting/](docs/formatting/)** - HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- üß™ **[docs/testing/](docs/testing/)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- ‚ú® **[docs/features/](docs/features/)** - –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
- üìñ **[docs/guides/](docs/guides/)** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ù–∞—á–Ω–∏—Ç–µ –∑–¥–µ—Å—å

1. **–ù–æ–≤—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫?** ‚Üí [docs/guides/START_HERE.md](docs/guides/START_HERE.md)
2. **HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?** ‚Üí [docs/formatting/HTML_FORMAT_EXAMPLES.md](docs/formatting/HTML_FORMAT_EXAMPLES.md)
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?** ‚Üí [docs/testing/TESTING_GUIDE.md](docs/testing/TESTING_GUIDE.md)
4. **–î–µ–ø–ª–æ–π?** ‚Üí [docs/formatting/DEPLOYMENT_GUIDE.md](docs/formatting/DEPLOYMENT_GUIDE.md)

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. QR Login
–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ QR –∫–æ–¥ –±–µ–∑ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

### 2. RAG (Retrieval-Augmented Generation)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø–æ—Å—Ç–∞–º –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
- AI-–æ—Ç–≤–µ—Ç—ã —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ—Å—Ç—ã + –≤–µ–±)

### 3. –î–∞–π–¥–∂–µ—Å—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- AI-–¥–∞–π–¥–∂–µ—Å—Ç—ã —Å —Å–∞–º–º–∞—Ä–∏ –ø–æ —Ç–µ–º–∞–º
- HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å expandable –±–ª–æ–∫–∞–º–∏

### 4. Groups –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π
- –î–∞–π–¥–∂–µ—Å—Ç—ã –≥—Ä—É–ø–ø–æ–≤—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n multi-agent workflows

### 5. –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —á–µ—Ä–µ–∑ SaluteSpeech API
- /ask –∏ /search –≥–æ–ª–æ—Å–æ–º
- –õ–∏–º–∏—Ç—ã –ø–æ subscription tiers

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
telethon/
‚îú‚îÄ‚îÄ bot.py                      # –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
‚îú‚îÄ‚îÄ telegram_formatter.py       # HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚≠ê
‚îú‚îÄ‚îÄ qr_auth_manager.py         # QR –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ voice_transcription_service.py  # –ì–æ–ª–æ—Å ‚Üí —Ç–µ–∫—Å—Ç
‚îú‚îÄ‚îÄ group_monitor_service.py   # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥—Ä—É–ø–ø
‚îú‚îÄ‚îÄ rag_service/               # RAG —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI endpoints
‚îÇ   ‚îú‚îÄ‚îÄ generator.py          # RAG –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ searcher.py           # –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ digest_generator.py   # –î–∞–π–¥–∂–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ scheduler.py          # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
‚îú‚îÄ‚îÄ models.py                  # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ database.py               # PostgreSQL
‚îî‚îÄ‚îÄ tests/                    # –¢–µ—Å—Ç—ã (42 passing ‚úÖ)
```

## üé® HTML –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (NEW!)

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π HTML —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ Telegram:

```html
<!-- Expandable blockquote –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –¥–ª–∏–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
<blockquote expandable>üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
1. @python_news (15.01.2024)
2. @dev_channel (10.01.2024)
</blockquote>

<!-- Spoilers -->
<tg-spoiler>–°–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç</tg-spoiler>

<!-- Code blocks —Å —è–∑—ã–∫–æ–º -->
<pre><code class="language-python">
def hello():
    print("world")
</code></pre>
```

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [docs/formatting/HTML_FORMAT_EXAMPLES.md](docs/formatting/HTML_FORMAT_EXAMPLES.md)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –¢–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest tests/test_telegram_formatter.py -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/ --cov=. --cov-report=html
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ 42/42 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11+**
- **python-telegram-bot** - Telegram Bot API
- **Telethon** - Telegram Client API
- **FastAPI** - RAG —Å–µ—Ä–≤–∏—Å
- **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis (Valkey)** - –ö–µ—à –∏ —Å–µ—Å—Å–∏–∏
- **Qdrant** - –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
- **GigaChat/OpenRouter** - LLM
- **n8n** - Workflows –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

## üìä Subscription Tiers

| Feature | Trial | Premium | Enterprise |
|---------|-------|---------|------------|
| Channels | 3 | 20 | 100 |
| RAG queries | 10/day | 100/day | 999/day |
| Voice queries | 20/day | 50/day | 999/day |
| AI Digests | ‚ùå | ‚úÖ | ‚úÖ |
| Groups Monitor | ‚ùå | 5 groups | 50 groups |

## üöÄ Deployment

**Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
cd /home/ilyasni/n8n-server/n8n-installer
docker-compose up -d telethon
docker logs telethon -f
```

**Manual:**
```bash
cd telethon
python bot.py
```

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [docs/formatting/DEPLOYMENT_GUIDE.md](docs/formatting/DEPLOYMENT_GUIDE.md)

## üìù Environment Variables

–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:

```bash
# Telegram
BOT_TOKEN=your_bot_token
MASTER_API_ID=your_api_id
MASTER_API_HASH=your_api_hash

# Database
DATABASE_URL=postgresql://user:pass@db:5432/telethon

# Redis
REDIS_HOST=redis
REDIS_PORT=6379

# RAG
QDRANT_HOST=http://qdrant:6333
GIGACHAT_ENABLED=true
OPENROUTER_API_KEY=your_key

# Voice
SALUTESPEECH_CLIENT_ID=your_id
SALUTESPEECH_CLIENT_SECRET=your_secret
```

## ü§ù Contributing

1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è —Ñ–∏—á–∏
2. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
4. –°–æ–∑–¥–∞—Ç—å pull request

**Code Style:**
- –°–ª–µ–¥–æ–≤–∞—Ç—å PEP 8
- Type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- Docstrings –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async/await

## üìÑ License

MIT License - —Å–º. [LICENSE](LICENSE)

## üìû Support

- **Issues:** GitHub Issues
- **Docs:** [docs/](docs/)
- **Examples:** [docs/formatting/HTML_FORMAT_EXAMPLES.md](docs/formatting/HTML_FORMAT_EXAMPLES.md)

---

**–í–µ—Ä—Å–∏—è:** 3.3.0 (HTML Formatting Update)  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
